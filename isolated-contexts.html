<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>Isolated Contexts</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
  <meta content="Bikeshed version 6270e4735, updated Tue Aug 6 12:12:30 2024 -0700" name="generator">
  <link href="https://wicg.github.io/isolated-web-apps/isolated-contexts" rel="canonical">
  <meta content="0fc145047c153cc5b281f2e821ad0b677e8f38e7" name="revision">
  <meta content="dark light" name="color-scheme">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-var-click-highlighting */
/*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)

For darkmode:
0 = oklab(50%   0%  108%)
1 = oklab(50% -51%   51%)
2 = oklab(50% -64%  -20%)
3 = oklab(50%   6%   19%)
4 = oklab(50% -12%  -64%)
5 = oklab(50%  44%  -19%)  
6 = oklab(50% 102%   38%)
*/

[data-algorithm] var { cursor: pointer; }
var[data-var-color] { background-color: var(--var-bg); box-shadow: 0 0 0 2px var(--var-bg); }

var[data-var-color] { --var-bg: #F4D200; }
var[data-var-color="1"] { --var-bg: #FF87A2; }
var[data-var-color="2"] { --var-bg: #96E885; }
var[data-var-color="3"] { --var-bg: #3EEED2; }
var[data-var-color="4"] { --var-bg: #EACFB6; }
var[data-var-color="5"] { --var-bg: #82DDFF; }
var[data-var-color="6"] { --var-vg: #FFBCF2; }

@media (prefers-color-scheme: dark) {
	var[data-var-color] { --var-bg: #bc1a00; }
	var[data-var-color="1"] { --var-bg: #007f00; }
	var[data-var-color="2"] { --var-bg: #008698; }
	var[data-var-color="3"] { --var-bg: #7f5b2b; }
	var[data-var-color="4"] { --var-bg: #004df3; }
	var[data-var-color="5"] { --var-bg: #a1248a; }
	var[data-var-color="6"] { --var-vg: #ff0000; }
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Isolated Contexts</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#CG-DRAFT">Draft Community Group Report</a>, <time class="dt-updated" datetime="2024-08-10">10 August 2024</time></p>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://wicg.github.io/isolated-web-apps/isolated-contexts">https://wicg.github.io/isolated-web-apps/isolated-contexts</a>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/WICG/isolated-web-apps/issues/">GitHub</a>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard" data-editor-id="139758"><a class="p-name fn u-email email" href="mailto:rmcelrath@google.com">Robbie McElrath</a> (<a class="p-org org" href="https://google.com">Google LLC</a>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 2024 the Contributors to the Isolated Contexts Specification, published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This specification defines "isolated contexts", which allow user agent
implementers and specification authors to enable certain features only when
minimum standards of isolation and integrity are met.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This specification was published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
  It is not a W3C Standard nor is it on the W3C Standards Track.

  Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

  Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#introduction"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li>
     <a href="#isolated-context-info"><span class="secno">2</span> <span class="content">Isolated Contexts</span></a>
     <ol class="toc">
      <li><a href="#which-apis"><span class="secno">2.1</span> <span class="content">Which APIs should require an Isolated Context?</span></a>
      <li><a href="#ui-treatment"><span class="secno">2.2</span> <span class="content">UI Treatment</span></a>
     </ol>
    <li>
     <a href="#monkey"><span class="secno">3</span> <span class="content">Monkey Patches</span></a>
     <ol class="toc">
      <li>
       <a href="#monkey-csp"><span class="secno">3.1</span> <span class="content">Content Security Policy</span></a>
       <ol class="toc">
        <li><a href="#csp-injection-mitigation"><span class="secno">3.1.1</span> <span class="content">Does a policy meaningfully mitigate injection attacks?</span></a>
        <li><a href="#csp-active-directive"><span class="secno">3.1.2</span> <span class="content">Obtain the active directive for a type</span></a>
        <li><a href="#csp-plugin-mitigation"><span class="secno">3.1.3</span> <span class="content">Does a policy sufficiently mitigate plugins?</span></a>
        <li><a href="#csp-relative-url"><span class="secno">3.1.4</span> <span class="content">Does a policy sufficiently mitigate relative URL manipulation?</span></a>
        <li><a href="#csp-script-mitigation"><span class="secno">3.1.5</span> <span class="content">Does a policy sufficiently mitigate script execution?</span></a>
        <li><a href="#csp-style-mitigation"><span class="secno">3.1.6</span> <span class="content">Does a policy sufficiently mitigate style evaluation?</span></a>
        <li><a href="#csp-subresources"><span class="secno">3.1.7</span> <span class="content">Does a policy sufficiently block insecure subresources?</span></a>
        <li><a href="#csp-sink-mitigation"><span class="secno">3.1.8</span> <span class="content">Does a policy sufficiently mitigate DOM sinks?</span></a>
        <li><a href="#csp-example"><span class="secno">3.1.9</span> <span class="content">Example</span></a>
        <li><a href="#csp-ui-redressing-mitigation"><span class="secno">3.1.10</span> <span class="content">Does a policy meaningfully mitigate UI Redressing attacks?</span></a>
       </ol>
      <li>
       <a href="#monkey-html"><span class="secno">3.2</span> <span class="content">HTML</span></a>
       <ol class="toc">
        <li><a href="#html-integrity"><span class="secno">3.2.1</span> <span class="content">Integrity</span></a>
        <li><a href="#html-environment-properties"><span class="secno">3.2.2</span> <span class="content">Environment Settings Object properties</span></a>
       </ol>
      <li>
       <a href="#monkey-fetch"><span class="secno">3.3</span> <span class="content">Fetch</span></a>
       <ol class="toc">
        <li><a href="#fetch-verify-response"><span class="secno">3.3.1</span> <span class="content">Verify the integrity of a response</span></a>
        <li><a href="#fetch-main-fetch"><span class="secno">3.3.2</span> <span class="content">Patches to the "Main Fetch" algorithm</span></a>
       </ol>
      <li>
       <a href="#monkey-webidl"><span class="secno">3.4</span> <span class="content">WebIDL</span></a>
       <ol class="toc">
        <li><a href="#IsolatedContext"><span class="secno">3.4.1</span> <span class="content"> [IsolatedContext] </span></a>
        <li><a href="#monkey-webidl-exposed"><span class="secno">3.4.2</span> <span class="content">Patches to the "exposed" algorithm</span></a>
       </ol>
      <li><a href="#monkey-storage"><span class="secno">3.5</span> <span class="content">Storage</span></a>
     </ol>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="introduction"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#introduction"></a></h2>
   <p>Throughout its existence the web has been evolved into an increasingly capable
application platform. <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#secure-context" id="ref-for-secure-context">Secure Contexts</a> formalize transport security, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-cross-origin-isolated-capability" id="ref-for-concept-settings-object-cross-origin-isolated-capability">Cross Origin
Isolation</a> mitigates side-channel attacks, and browsers and operating systems
have experimented with permission interfaces based on selecting particular
files and devices to make access more scoped and understandable to users. Each
of these advancements either improved the safety guarantees of the web
platform, or guided users towards a more accurate expection of a page’s
behavior, and unlocked new classes of capabilities that could be brought safely
to the web.</p>
   <p>Despite these advancements, there are some APIs that still cannot safely be
exposed to the web because they violate the web’s security primitives in a way
that cannot reasonably be addressed, or cannot be explained clearly enough for
users to make an informed decision about whether or not to grant a site access
to them. If the platform cannot prove that exposing an API to a particular site
is safe, then trust must derive from external attestations.</p>
   <p>Any assertion about the safety or behavior of a page requires knowing the
contents and behavior of the page; attestations are only meaningful if the code
that was vouched for is the same code being executed. Because of this, any
system that delegates trust decisions must be able to verify the integrity of
the code it is running — it must know that it matches the code that was
delegated trust.</p>
   <p>Additionally, capabilities that don’t fit within the web’s current security
model have the potential to pose a risk to other web content. This risk is
bidirectional: sandbox-piercing capabilities could be used to attack other
sites, and having access to powerful capabilities makes a site a more
attractive target for bad actors. To mitigate these risks, any content that is
granted access to a capability through the mechanisms described in this
specification must be isolated from a user’s normal browsing session.</p>
   <p>This specification defines <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="isolated-contexts">Isolated Contexts</dfn>, which are environments
that meet a minimum standard of integrity and isolation, and provide a means of
auditing web content for the purpose of trustworthiness attestation, and
isolate this content from the rest of the user’s browsing data.</p>
   <p>While this specification focuses on user-agent provided capabilities, Isolated
Contexts could be beneficial for any web page functionality whose threat model
isn’t satisfied by the web’s security model. For example, the threat model of
some end-to-end encrypted chat applications includes server compromise, which
is not protected against by the web today. The auditability and attestation
enabled by Isolated Contexts could allow these applications to have confidence
in the integrity and providence of the code they are running.</p>
   <h2 class="heading settled" data-level="2" id="isolated-context-info"><span class="secno">2. </span><span class="content">Isolated Contexts</span><a class="self-link" href="#isolated-context-info"></a></h2>
   <p><a data-link-type="dfn" href="#isolated-contexts" id="ref-for-isolated-contexts">Isolated Contexts</a> are defined through a series of <a href="#monkey">§ 3 Monkey Patches</a> to existing
specifications.</p>
   <p>Integrity is verified through a combination of strict <a data-link-type="biblio" href="#biblio-csp" title="Content Security Policy Level 3">[CSP]</a>, which ensures
cross-origin executable content cannot be loaded, and an integrity verification
algorithm, which is an abstract mechanism to validate content loaded within a
page. This specification does not mandate a specific validation approach, it
only defines how one would be used to determine if an environment is an
Isolated Context.</p>
   <h3 class="heading settled" data-level="2.1" id="which-apis"><span class="secno">2.1. </span><span class="content">Which APIs should require an Isolated Context?</span><a class="self-link" href="#which-apis"></a></h3>
   <p>As few as possible. Any API that can only be exposed to Isolated Contexts very
likely violates at least one <a href="https://w3ctag.github.io/design-principles/#basic-principles"> design principle</a> of the web, most commonly that <a href="https://w3ctag.github.io/design-principles/#safe-to-browse"> it should be safe to visit a web page</a>. Before requiring an Isolated Context
to use an API, consider the following questions:</p>
   <ol>
    <li data-md>
     <p>Is a new Web Platform API the only way to address the problems this API is
trying to solve? Web Extensions and native applications have their place.</p>
    <li data-md>
     <p>If a capability cannot be communicated clearly to users, is there another
way to solve the problem that would be more understandable to users, and
allow them to make informed decisions about what content can access it?</p>
    <li data-md>
     <p>Can the scope of the API be reduced such that it no longer poses an
unacceptable risk if exposed to an average web page?</p>
   </ol>
   <p>If no alternative can be found, requiring an API to run within an Isolated
Context can be considered as a last resort.</p>
   <p>Part of what makes the web such a unique and successful platform is its lack of
gatekeepers. Anyone can purchase a domain name and host their content without
anyone else’s approval, and with full access to the Web Platform’s API surface;
everyone has equal footing. The security guarantees provided by Isolated
Contexts enable auditability, which in turn enables attestation. The safety
provided by attestation, either by the browser vendor or a third-party, is the
main reason an API would be restricted to Isolated Contexts. Parties providing
attestation services have the potential to become gatekeepers to the Web
Platform, which is not a desirable direction for the platform to move. Browser
vendors must be extremely selective about which APIs they allow in Isolated
Contexts; changing an API so it can be used in a Secure Context should be
strongly preferred whenever possible.</p>
   <h3 class="heading settled" data-level="2.2" id="ui-treatment"><span class="secno">2.2. </span><span class="content">UI Treatment</span><a class="self-link" href="#ui-treatment"></a></h3>
   <p>This specification focuses on the technical requirements needed to achieve
integrity and isolation, but if Isolated Contexts are being used to enable
powerful capabilities, it is also critical to not violate user expectations.</p>
   <p>Users trust the web because they’ve been taught that web pages are safe, have
limited access to their device, and that they are in control of this access. All
APIs on the Web Platform have been carefully designed towards this end, with a
goal of ensuring that <a href="https://w3ctag.github.io/design-principles/#safe-to-browse"> it should be safe to visit a web page</a>.</p>
   <p>Browser vendors should consider whether capabilities restricted to Isolated
Contexts would violate a user’s expectation of what a web page is capable of
doing. Violating these expectations would not only damage trust in the site, but
has the risk of damaging a user’s trust in the Web Platform as a whole.</p>
   <p>To mitigate this, steps should be taken by the user agent to convey to users
that content running within an Isolated Context is not typical web content. This
could involve an installation flow, or a Web App UI treatment.</p>
   <h2 class="heading settled" data-level="3" id="monkey"><span class="secno">3. </span><span class="content">Monkey Patches</span><a class="self-link" href="#monkey"></a></h2>
   <p>This specification makes the following monkey patches to existing
specifications:</p>
   <ul>
    <li data-md>
     <p><a data-link-type="biblio" href="#biblio-csp" title="Content Security Policy Level 3">[CSP]</a> will define the characteristics of a policy that’s robust enough to
meaningfully defend against attack, and enforce that cross-origin content
cannot be loaded. It builds on what we’ve learned from explorations like <a data-link-type="biblio" href="#biblio-strict-csp" title="Mitigate cross-site scripting (XSS) with a strict Content Security Policy (CSP)">[strict-csp]</a> and <a data-link-type="biblio" href="#biblio-securer-contexts" title="Securer Contexts">[securer-contexts]</a>, pushing developers towards
well-understood and valuable defenses.</p>
    <li data-md>
     <p><a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a> will define the ways in which those CSP characteristics, along
with other security requirements, are evaluated within a given context,
similar conceptually to <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#secure-context" id="ref-for-secure-context①">secure context</a> and <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-cross-origin-isolated-capability" id="ref-for-concept-settings-object-cross-origin-isolated-capability①">cross-origin isolated capability</a>. It will additionally define <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent">user agent</a> properties needed to verify the integrity of
an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin">origin</a>'s resources.</p>
    <li data-md>
     <p><a data-link-type="biblio" href="#biblio-fetch" title="Fetch Standard">[FETCH]</a> will add integrity verification to the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch">fetch</a> algorithm.</p>
    <li data-md>
     <p><a data-link-type="biblio" href="#biblio-webidl" title="Web IDL Standard">[WEBIDL]</a> will define the <code>[IsolatedContext]</code> attribute, and the way it
relies on the changes above to control the exposure of a given WebIDL
construct.</p>
    <li data-md>
     <p><a data-link-type="biblio" href="#biblio-storage" title="Storage Standard">[STORAGE]</a> will define the double-keying requirements of <a data-link-type="dfn" href="#isolated-contexts" id="ref-for-isolated-contexts①">Isolated Contexts</a>.</p>
   </ul>
   <h3 class="heading settled" data-level="3.1" id="monkey-csp"><span class="secno">3.1. </span><span class="content">Content Security Policy</span><a class="self-link" href="#monkey-csp"></a></h3>
   <p>In <a data-link-type="biblio" href="#biblio-csp" title="Content Security Policy Level 3">[CSP]</a>, we’ll define an algorithm for evaluating the strength of the
amalgamation of policies contained within a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#csp-list" id="ref-for-csp-list">CSP list</a>. We’ll define a
few supporting algorithms as well, but <a href="#csp-injection-mitigation">§ 3.1.1 Does a policy meaningfully mitigate injection attacks?</a> is the core entry point CSP will expose to HTML.</p>
   <h4 class="heading settled" data-level="3.1.1" id="csp-injection-mitigation"><span class="secno">3.1.1. </span><span class="content">Does a policy meaningfully mitigate injection attacks?</span><a class="self-link" href="#csp-injection-mitigation"></a></h4>
   <div class="algorithm" data-algorithm="meaningfully mitigates injection">
     A <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#csp-list" id="ref-for-csp-list①">CSP list</a> <var>policies</var> is said to <dfn class="dfn-paneled" data-dfn-for="CSP list" data-dfn-type="dfn" data-export data-local-lt="mitigate-injection" data-lt="meaningfully mitigate injection attacks" id="csp-list-meaningfully-mitigate-injection-attacks">meaningfully
mitigate injection attacks</dfn> if the following algorithm returns
"<code>Meaningful</code>". Possible return values are "<code>Meaningful</code>" and
"<code>Not meaningful enough</code>". 
    <ol class="algorithm">
     <li data-md>
      <p>Let <var>meets object requirements</var>, <var>meets base requirements</var>, <var>meets script requirements</var>, <var>meets style requirements</var>, <var>meets subresource requirements</var>, and <var>meets trusted type requirements</var> be <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#boolean" id="ref-for-boolean">booleans</a> whose values are <code>false</code>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate">For each</a> <var>policy</var> in <var>policies</var>:</p>
      <ol>
       <li data-md>
        <p>If <var>policy</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-disposition" id="ref-for-policy-disposition">disposition</a> is not "<code>enforce</code>" or <var>policy</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-source" id="ref-for-policy-source">source</a> is not "<code>header</code>", <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue">continue</a>.</p>
       <li data-md>
        <p>If <var>policy</var> <a data-link-type="dfn" href="#policy-sufficiently-mitigates-plugins" id="ref-for-policy-sufficiently-mitigates-plugins">sufficiently mitigates plugins</a>, set <var>meets object requirements</var> to <code>true</code>.</p>
       <li data-md>
        <p>If <var>policy</var> <a data-link-type="dfn" href="#policy-sufficiently-mitigates-relative-url-manipulation" id="ref-for-policy-sufficiently-mitigates-relative-url-manipulation">sufficiently mitigates relative URL manipulation</a>, set <var>meets base requirements</var> to <code>true</code>.</p>
       <li data-md>
        <p>If <var>policy</var> <a data-link-type="dfn" href="#policy-sufficiently-mitigates-script-execution" id="ref-for-policy-sufficiently-mitigates-script-execution">sufficiently mitigates script execution</a>, set <var>meets script requirements</var> to <code>true</code>.</p>
       <li data-md>
        <p>If <var>policy</var> <a data-link-type="dfn" href="#policy-sufficiently-mitigates-style-evaluation" id="ref-for-policy-sufficiently-mitigates-style-evaluation">sufficiently mitigates style evaluation</a>, set <var>meets style requirements</var> to <code>true</code>.</p>
       <li data-md>
        <p>If <var>policy</var> <a data-link-type="dfn" href="#policy-sufficiently-blocks-insecure-subresources" id="ref-for-policy-sufficiently-blocks-insecure-subresources">sufficiently blocks insecure subresources</a>, set <var>meets subresource requirements</var> to <code>true</code>.</p>
       <li data-md>
        <p>If <var>policy</var> <a data-link-type="dfn" href="#policy-sufficiently-mitigates-dom-sinks" id="ref-for-policy-sufficiently-mitigates-dom-sinks">sufficiently mitigates DOM sinks</a>, set <var>meets trusted type requirements</var> to <code>true</code>.</p>
      </ol>
     <li data-md>
      <p>Return "<code>Meaningful</code>" if <var>meets object requirements</var>, <var>meets base requirements</var>, <var>meets script requirements</var>, <var>meets style requirements</var>, <var>meets subresource requirements</var>, and <var>meets trusted type requirements</var> are all <code>true</code>.</p>
     <li data-md>
      <p>Return "<code>Not meaningful enough</code>".</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="3.1.2" id="csp-active-directive"><span class="secno">3.1.2. </span><span class="content">Obtain the active directive for a type</span><a class="self-link" href="#csp-active-directive"></a></h4>
   <div class="algorithm" data-algorithm="get active directive">
     CSP defines a fallback chain for some directives which we need to account for
when evaluating a given policy. To <dfn class="dfn-paneled" data-dfn-type="abstract-op" data-export data-lt="obtain-directive" id="abstract-opdef-obtain-directive">obtain
the active directive</dfn> given a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy" id="ref-for-violation-policy">policy</a> <var>policy</var> and a <var>directive name</var>: 
    <ol class="algorithm">
     <li data-md>
      <p>Let <var>fallback chain</var> be the result of executing <a data-link-type="abstract-op" href="https://w3c.github.io/webappsec-csp/#directive-fallback-list" id="ref-for-directive-fallback-list">Get fetch
directive fallback list</a> on <var>directive name</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate①">For each</a> <var>name</var> in <var>fallback chain</var>:</p>
      <ol>
       <li data-md>
        <p>If <var>policy</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set" id="ref-for-policy-directive-set">directive set</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain">contains</a> a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives" id="ref-for-directives">directive</a> <var>directive</var> whose <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name" id="ref-for-directive-name">name</a> is <var>name</var>,
return <var>directive</var>.</p>
      </ol>
     <li data-md>
      <p>Return null.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="3.1.3" id="csp-plugin-mitigation"><span class="secno">3.1.3. </span><span class="content">Does a policy sufficiently mitigate plugins?</span><a class="self-link" href="#csp-plugin-mitigation"></a></h4>
   <div class="algorithm" data-algorithm="object requirements">
     A <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy" id="ref-for-violation-policy①">policy</a> <var>policy</var> <dfn class="dfn-paneled" data-dfn-for="policy" data-dfn-type="dfn" data-noexport id="policy-sufficiently-mitigates-plugins">sufficiently mitigates plugins</dfn> if
the following algorithm returns "<code>Sufficient</code>". Possible return values are
"<code>Sufficient</code>" and "<code>Not sufficient</code>". 
    <ol class="algorithm">
     <li data-md>
      <p><a data-link-type="abstract-op" href="#abstract-opdef-obtain-directive" id="ref-for-abstract-opdef-obtain-directive">Obtain</a> <var>active directive</var> from <var>policy</var>, given "<code>object-src</code>".</p>
     <li data-md>
      <p>Return "<code>Sufficient</code>" if all of the following are true:</p>
      <ul>
       <li data-md>
        <p><var>active directive</var> is not null</p>
       <li data-md>
        <p><var>active directive</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value">value</a>'s <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size">size</a> is 1</p>
       <li data-md>
        <p><var>active directive</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value①">value</a>[0] is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-case-insensitive" id="ref-for-ascii-case-insensitive">ASCII case-insensitive</a> match for the string
"<a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-none" id="ref-for-grammardef-none"><code>'none'</code></a>".</p>
      </ul>
     <li data-md>
      <p>Return "<code>Not sufficient</code>".</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="3.1.4" id="csp-relative-url"><span class="secno">3.1.4. </span><span class="content">Does a policy sufficiently mitigate relative URL manipulation?</span><a class="self-link" href="#csp-relative-url"></a></h4>
   <div class="algorithm" data-algorithm="base requirements">
     A <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy" id="ref-for-violation-policy②">policy</a> <var>policy</var> <dfn class="dfn-paneled" data-dfn-for="policy" data-dfn-type="dfn" data-lt="sufficiently mitigates relative URL manipulation" data-noexport id="policy-sufficiently-mitigates-relative-url-manipulation">sufficiently mitigates relative URL
manipulation</dfn> if the following algorithm returns "<code>Sufficient</code>".
Possible return values are "<code>Sufficient</code>" and "<code>Not sufficient</code>". 
    <ol class="algorithm">
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate②">For each</a> <var>directive</var> in <var>policy</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set" id="ref-for-policy-directive-set①">directive set</a>:</p>
      <ol>
       <li data-md>
        <p>Return "<code>Sufficient</code>" if all of the following are true:</p>
        <ul>
         <li data-md>
          <p><var>directive</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name" id="ref-for-directive-name①">name</a> is "<code>base-uri</code>".</p>
         <li data-md>
          <p><var>directive</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value②">value</a>'s <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size①">size</a> is 1</p>
         <li data-md>
          <p><var>directive</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value③">value</a>[0] is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-case-insensitive" id="ref-for-ascii-case-insensitive①">ASCII case-insensitive</a> match for either the string
"<a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-none" id="ref-for-grammardef-none①"><code>'none'</code></a>" or the string "<a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-self" id="ref-for-grammardef-self"><code>'self'</code></a>".</p>
        </ul>
      </ol>
     <li data-md>
      <p>Return "<code>Not sufficient</code>".</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="3.1.5" id="csp-script-mitigation"><span class="secno">3.1.5. </span><span class="content">Does a policy sufficiently mitigate script execution?</span><a class="self-link" href="#csp-script-mitigation"></a></h4>
   <div class="algorithm" data-algorithm="script requirements">
     A <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy" id="ref-for-violation-policy③">policy</a> <var>policy</var> <dfn class="dfn-paneled" data-dfn-for="policy" data-dfn-type="dfn" data-noexport id="policy-sufficiently-mitigates-script-execution">sufficiently mitigates script execution</dfn> if the following algorithm returns "<code>Sufficient</code>".
Possible return values are "<code>Sufficient</code>" and "<code>Not sufficient</code>". 
    <ol class="algorithm">
     <li data-md>
      <p><a data-link-type="abstract-op" href="#abstract-opdef-obtain-directive" id="ref-for-abstract-opdef-obtain-directive①">Obtain</a> <var>active directive</var> from <var>policy</var>, given "<code>script-src</code>".</p>
     <li data-md>
      <p>Return "<code>Sufficient</code>" if all of the following are true:</p>
      <ul>
       <li data-md>
        <p><var>active directive</var> is not null</p>
       <li data-md>
        <p>All <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-expression" id="ref-for-source-expression">source expressions</a> in <var>active directive</var> are an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-case-insensitive" id="ref-for-ascii-case-insensitive②">ASCII case-insensitive</a> match for the strings
"<a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-none" id="ref-for-grammardef-none②"><code>'none'</code></a>", "<a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-self" id="ref-for-grammardef-self①"><code>'self'</code></a>", or
"<a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-wasm-unsafe-eval" id="ref-for-grammardef-wasm-unsafe-eval"><code>'wasm-unsafe-eval'</code></a>".</p>
      </ul>
     <li data-md>
      <p>Return "<code>Not sufficient</code>".</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="3.1.6" id="csp-style-mitigation"><span class="secno">3.1.6. </span><span class="content">Does a policy sufficiently mitigate style evaluation?</span><a class="self-link" href="#csp-style-mitigation"></a></h4>
   <div class="algorithm" data-algorithm="style requirements">
     A <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy" id="ref-for-violation-policy④">policy</a> <var>policy</var> <dfn class="dfn-paneled" data-dfn-for="policy" data-dfn-type="dfn" data-noexport id="policy-sufficiently-mitigates-style-evaluation">sufficiently mitigates style evaluation</dfn> if
the following algorithm returns "<code>Sufficient</code>".
Possible return values are "<code>Sufficient</code>" and "<code>Not sufficient</code>". 
    <ol class="algorithm">
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate③">For each</a> <var>directive</var> in <var>policy</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set" id="ref-for-policy-directive-set②">directive set</a>:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="abstract-op" href="#abstract-opdef-obtain-directive" id="ref-for-abstract-opdef-obtain-directive②">Obtain</a> <var>active directive</var> from <var>policy</var>, given "<code>style-src</code>".</p>
       <li data-md>
        <p>Return "<code>Sufficient</code>" if all of the following are true:</p>
        <ul>
         <li data-md>
          <p><var>directive</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name" id="ref-for-directive-name②">name</a> is "<code>style-src</code>".</p>
         <li data-md>
          <p>All <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-expression" id="ref-for-source-expression①">source expressions</a> in <var>active directive</var> are an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-case-insensitive" id="ref-for-ascii-case-insensitive③">ASCII case-insensitive</a> match for the strings
"<a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-none" id="ref-for-grammardef-none③"><code>'none'</code></a>", "<a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-self" id="ref-for-grammardef-self②"><code>'self'</code></a>", or
"<a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-unsafe-inline" id="ref-for-grammardef-unsafe-inline"><code>'unsafe-inline'</code></a>".</p>
        </ul>
      </ol>
     <li data-md>
      <p>Return "<code>Not sufficient</code>".</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="3.1.7" id="csp-subresources"><span class="secno">3.1.7. </span><span class="content">Does a policy sufficiently block insecure subresources?</span><a class="self-link" href="#csp-subresources"></a></h4>
   <div class="algorithm" data-algorithm="subresource requirements">
     A <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy" id="ref-for-violation-policy⑤">policy</a> <var>policy</var> <dfn class="dfn-paneled" data-dfn-for="policy" data-dfn-type="dfn" data-lt="sufficiently blocks insecure subresources" data-noexport id="policy-sufficiently-blocks-insecure-subresources">sufficiently blocks insecure
subresources</dfn> if the following algorithm returns "<code>Sufficient</code>".
Possible return values are "<code>Sufficient</code>" and "<code>Not sufficient</code>". 
    <ol class="algorithm">
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate④">For each</a> <var>directive name</var> in the set [<code>frame-src</code>, <code>connect-src</code>, <code>img-src</code>, <code>media-src</code>, <code>font-src</code>]:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="abstract-op" href="#abstract-opdef-obtain-directive" id="ref-for-abstract-opdef-obtain-directive③">Obtain</a> <var>active directive</var> from <var>policy</var>, given <var>directive name</var>.</p>
       <li data-md>
        <p>Return "<code>Not sufficient</code>" if any <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-expression" id="ref-for-source-expression②">source expression</a> in <var>active directive</var> is <strong>not</strong> an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-case-insensitive" id="ref-for-ascii-case-insensitive④">ASCII case-insensitive</a> match
for the strings "<a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-none" id="ref-for-grammardef-none④"><code>'none'</code></a>", "<a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-self" id="ref-for-grammardef-self③"><code>'self'</code></a>",
"<code>https:</code>", "<code>blob:</code>", or "<code>data:</code>".</p>
      </ol>
     <li data-md>
      <p>Return "<code>Sufficient</code>"</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="3.1.8" id="csp-sink-mitigation"><span class="secno">3.1.8. </span><span class="content">Does a policy sufficiently mitigate DOM sinks?</span><a class="self-link" href="#csp-sink-mitigation"></a></h4>
   <div class="algorithm" data-algorithm="trusted type requirements">
     A <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy" id="ref-for-violation-policy⑥">policy</a> <var>policy</var> <dfn class="dfn-paneled" data-dfn-for="policy" data-dfn-type="dfn" data-noexport id="policy-sufficiently-mitigates-dom-sinks">sufficiently mitigates DOM sinks</dfn> if the following algorithm returns "<code>Sufficient</code>".
Possible return values are "<code>Sufficient</code>" and "<code>Not sufficient</code>". 
    <ol class="algorithm">
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate⑤">For each</a> <var>directive</var> in <var>policy</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set" id="ref-for-policy-directive-set③">directive set</a>:</p>
      <ol>
       <li data-md>
        <p>Return "<code>Sufficient</code>" if all of the following are true:</p>
        <ul>
         <li data-md>
          <p><var>directive</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name" id="ref-for-directive-name③">name</a> is
"<code><a data-link-type="dfn" href="https://w3c.github.io/trusted-types/dist/spec/#require-trusted-types-for-directive" id="ref-for-require-trusted-types-for-directive">require-trusted-types-for</a></code>". <a data-link-type="biblio" href="#biblio-trusted-types" title="Trusted Types">[TRUSTED-TYPES]</a></p>
         <li data-md>
          <p><var>directive</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value④">value</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain①">contains</a>[0] an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-case-insensitive" id="ref-for-ascii-case-insensitive⑤">ASCII case-insensitive</a> match for the string "<code>'script'</code>".</p>
        </ul>
      </ol>
     <li data-md>
      <p>Return "<code>Not sufficient</code>".</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="3.1.9" id="csp-example"><span class="secno">3.1.9. </span><span class="content">Example</span><a class="self-link" href="#csp-example"></a></h4>
   <p>The following CSP <a data-link-type="dfn" href="#csp-list-meaningfully-mitigate-injection-attacks" id="ref-for-csp-list-meaningfully-mitigate-injection-attacks">meaningfully mitigates injection
attacks</a>:</p>
<pre class="example" id="example-36d1a54a"><a class="self-link" href="#example-36d1a54a"></a>base-uri 'none';
default-src 'self';
object-src 'none';
script-src 'self' 'wasm-unsafe-eval';
style-src 'self' 'unsafe-inline';
frame-src 'self' https: blob: data:;
connect-src 'self' https: blob: data:;
img-src 'self' https: blob: data:;
media-src 'self' https: blob: data:;
font-src 'self' blob: data:;
require-trusted-types-for 'script';
</pre>
   <h4 class="heading settled" data-level="3.1.10" id="csp-ui-redressing-mitigation"><span class="secno">3.1.10. </span><span class="content">Does a policy meaningfully mitigate UI Redressing attacks?</span><a class="self-link" href="#csp-ui-redressing-mitigation"></a></h4>
   <div class="algorithm" data-algorithm="meaningfully mitigates ui redressing">
     A <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#csp-list" id="ref-for-csp-list②">CSP list</a> <var>policies</var> is said to <dfn class="dfn-paneled" data-dfn-for="CSP list" data-dfn-type="dfn" data-export data-local-lt="mitigate-ui-redressing" data-lt="meaningfully mitigate UI Redressing attacks" id="csp-list-meaningfully-mitigate-ui-redressing-attacks">meaningfully
mitigate UI Redressing attacks</dfn> <a data-link-type="biblio" href="#biblio-uisecurity" title="User Interface Security and the Visibility API">[UISECURITY]</a> if the following algorithm
returns "<code>Meaningful</code>".
Possible return values are "<code>Meaningful</code>" and "<code>Not meaningful enough</code>". 
    <ol class="algorithm">
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate⑥">For each</a> <var>policy</var> in <var>policies</var>:</p>
      <ol>
       <li data-md>
        <p>If <var>policy</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-disposition" id="ref-for-policy-disposition①">disposition</a> is not "<code>enforce</code>" or <var>policy</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-source" id="ref-for-policy-source①">source</a> is not "<code>header</code>", <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①">continue</a>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate⑦">For each</a> <var>directive</var> in <var>policy</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set" id="ref-for-policy-directive-set④">directive set</a>:</p>
        <ol>
         <li data-md>
          <p>Return "<code>Meaningful</code>" if all of the following are true:</p>
          <ul>
           <li data-md>
            <p><var>directive</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name" id="ref-for-directive-name④">name</a> is "<code>frame-ancestors</code>".</p>
           <li data-md>
            <p><var>directive</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value⑤">value</a>'s <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size②">size</a> is 1</p>
           <li data-md>
            <p><var>directive</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value⑥">value</a>[0] is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-case-insensitive" id="ref-for-ascii-case-insensitive⑥">ASCII case-insensitive</a> match for either the string
"<a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-none" id="ref-for-grammardef-none⑤"><code>'none'</code></a>" or the string "<a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-self" id="ref-for-grammardef-self④"><code>'self'</code></a>".</p>
          </ul>
        </ol>
      </ol>
     <li data-md>
      <p>Return "<code>Not meaningful enough</code>".</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="3.2" id="monkey-html"><span class="secno">3.2. </span><span class="content">HTML</span><a class="self-link" href="#monkey-html"></a></h3>
   <p>In HTML, we’ll define a few properties used for resource integrity verification,
and some algorithms used in combination with those defined in <a href="#monkey-csp">§ 3.1 Content Security Policy</a> to define characteristics of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object">environment settings object</a>. These characteristics will be examined from <a data-link-type="biblio" href="#biblio-webidl" title="Web IDL Standard">[WEBIDL]</a> when determining whether or not a given IDL construct is exposed on
the associated <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global">global object</a>.</p>
   <h4 class="heading settled" data-level="3.2.1" id="html-integrity"><span class="secno">3.2.1. </span><span class="content">Integrity</span><a class="self-link" href="#html-integrity"></a></h4>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="integrity-verification-algorithm">integrity verification algorithm</dfn> is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined">implementation-defined</a> algorithm that accepts a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#fetch-params-request" id="ref-for-fetch-params-request">request</a> and a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response">response</a>, and returns a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#boolean" id="ref-for-boolean①">boolean</a>.</p>
   <p class="note" role="note"><span class="marker">Note:</span> A typical <a data-link-type="dfn" href="#integrity-verification-algorithm" id="ref-for-integrity-verification-algorithm">integrity verification algorithm</a> might verify that a
response body hashes to an expected value, or that it originated from a known
bundle of resources.</p>
   <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent①">user agent</a> holds an <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="origin-integrity-verification-map">origin integrity verification map</dfn>,
which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map">map</a> of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-tuple" id="ref-for-concept-origin-tuple">tuple origins</a> to <a data-link-type="dfn" href="#integrity-verification-algorithm" id="ref-for-integrity-verification-algorithm①">integrity verification algorithms</a>.</p>
   <p class="note" role="note"><span class="marker">Note:</span> How user agents populate the <a data-link-type="dfn" href="#origin-integrity-verification-map" id="ref-for-origin-integrity-verification-map">origin integrity verification map</a> is
outside the scope of this specification, which is focused on the properties
needed to establish integrity and isolation. <a href="https://github.com/WICG/isolated-web-apps/">Isolated Web Apps</a> provide one possible implementation by basing this map on the set of installed
Isolated Web Apps.</p>
   <h4 class="heading settled" data-level="3.2.2" id="html-environment-properties"><span class="secno">3.2.2. </span><span class="content">Environment Settings Object properties</span><a class="self-link" href="#html-environment-properties"></a></h4>
   <div class="algorithm" data-algorithm="environment settings object mitigates injection"> An <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object①">environment settings object</a> is said to <dfn class="dfn-paneled" data-dfn-for="environment settings object" data-dfn-type="dfn" data-export data-lt="meaningfully mitigate injection attacks" id="environment-settings-object-meaningfully-mitigate-injection-attacks">meaningfully mitigate injection
attacks</dfn> if its <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-policy-container" id="ref-for-concept-settings-object-policy-container">policy container</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#policy-container-csp-list" id="ref-for-policy-container-csp-list">CSP list</a> <a data-link-type="dfn" href="#csp-list-meaningfully-mitigate-injection-attacks" id="ref-for-csp-list-meaningfully-mitigate-injection-attacks①"> meaningfully mitigates injection attacks</a>. </div>
   <div class="algorithm" data-algorithm="environment settings object mitigates ui redressing"> An <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object②">environment settings object</a> is said to <dfn class="dfn-paneled" data-dfn-for="environment settings object" data-dfn-type="dfn" data-export data-lt="mitigate UI Redressing attacks" id="environment-settings-object-mitigate-ui-redressing-attacks">mitigate UI Redressing attacks </dfn> if its <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-policy-container" id="ref-for-concept-settings-object-policy-container①">policy container</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#policy-container-csp-list" id="ref-for-policy-container-csp-list①">CSP list</a> <a data-link-type="dfn" href="#csp-list-meaningfully-mitigate-ui-redressing-attacks" id="ref-for-csp-list-meaningfully-mitigate-ui-redressing-attacks"> meaningfully mitigates UI Redressing attacks</a>. </div>
   <p class="note" role="note"><span class="marker">Note:</span> Because the definition of meaningful injection and UI Redressing
mitigation for a CSP list depends only upon the header-delivered policies,
these properties will not mutate during an environment’s lifetime.</p>
   <div class="algorithm" data-algorithm="environment settings object is an isolated context">
     An <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object③">environment settings object</a> <var>environment</var> is an <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="isolated-context">isolated context</dfn> if the following algorithm returns <code>true</code>: 
    <ol>
     <li data-md>
      <p>If <var>environment</var> does not <a data-link-type="dfn" href="#environment-settings-object-meaningfully-mitigate-injection-attacks" id="ref-for-environment-settings-object-meaningfully-mitigate-injection-attacks">meaningfully
mitigate injection attacks</a>, return <code>false</code>.</p>
     <li data-md>
      <p>If <var>environment</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-cross-origin-isolated-capability" id="ref-for-concept-settings-object-cross-origin-isolated-capability②">cross-origin isolated capability</a> is
not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#cross-origin-isolation-concrete" id="ref-for-cross-origin-isolation-concrete">concrete</a>, return <code>false</code>.</p>
     <li data-md>
      <p>If <var>environment</var> does not <a data-link-type="dfn" href="#environment-settings-object-mitigate-ui-redressing-attacks" id="ref-for-environment-settings-object-mitigate-ui-redressing-attacks">mitigate UI
Redressing attacks</a>, return <code>false</code>.</p>
     <li data-md>
      <p>Let <var>origin</var> be <var>environment</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin①">origin</a>.</p>
     <li data-md>
      <p>If the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent②">user agent</a>'s <a data-link-type="dfn" href="#origin-integrity-verification-map" id="ref-for-origin-integrity-verification-map①">origin integrity verification map</a>[<var>origin</var>]
does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists">exist</a>, return <code>false</code>.</p>
     <li data-md>
      <p>Return <code>true</code>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="3.3" id="monkey-fetch"><span class="secno">3.3. </span><span class="content">Fetch</span><a class="self-link" href="#monkey-fetch"></a></h3>
   <p>In Fetch, we’ll use the <a data-link-type="dfn" href="#integrity-verification-algorithm" id="ref-for-integrity-verification-algorithm②">integrity verification algorithm</a> defined in <a href="#html-integrity">§ 3.2.1 Integrity</a> to verify that responses have the expected contents.</p>
   <h4 class="heading settled" data-level="3.3.1" id="fetch-verify-response"><span class="secno">3.3.1. </span><span class="content">Verify the integrity of a response</span><a class="self-link" href="#fetch-verify-response"></a></h4>
   <div class="algorithm" data-algorithm="verify the integrity of a response">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="verify-the-integrity-of-a-response">verify the integrity of a response</dfn> given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#fetch-params-request" id="ref-for-fetch-params-request①">request</a> <var>request</var> and a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response①">response</a> <var>response</var>, run these steps. Possible return values are
"<code>not applicable</code>", "<code>invalid</code>", or "<code>valid</code>". 
    <ol>
     <li>Let <var>client</var> be <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client">client</a>.
     <li>If <var>client</var> is <code>null</code>, return "<code>not applicable</code>".
     <li>Let <var>origin</var> be <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-origin" id="ref-for-concept-request-origin">origin</a>.
     <li> If the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent③">user agent</a>'s <a data-link-type="dfn" href="#origin-integrity-verification-map" id="ref-for-origin-integrity-verification-map②">origin integrity verification map</a>[<var>origin</var>]
    does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①">exist</a>, return "<code>not applicable</code>". 
     <li> Let <var>integrity verification algorithm</var> be the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent④">user agent</a>'s <a data-link-type="dfn" href="#origin-integrity-verification-map" id="ref-for-origin-integrity-verification-map③">origin integrity verification map</a>[<var>origin</var>]. 
     <li> If <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body">body</a> is <code>null</code>, return "<code>invalid</code>". 
     <li> If the result of executing <var>integrity verification algorithm</var> given <var>request</var> and <var>response</var> is <code>false</code>, return "<code>invalid</code>". 
     <li> Return "<code>valid</code>". 
    </ol>
   </div>
   <h4 class="heading settled" data-level="3.3.2" id="fetch-main-fetch"><span class="secno">3.3.2. </span><span class="content">Patches to the "Main Fetch" algorithm</span><a class="self-link" href="#fetch-main-fetch"></a></h4>
    The <a data-link-type="dfn" href="#monkey-main-fetch" id="ref-for-monkey-main-fetch">main fetch</a> algorithm is extended as follows: 
   <div class="algorithm" data-algorithm="main fetch">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="monkey-main-fetch">main fetch</dfn>, given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#fetch-params" id="ref-for-fetch-params">fetch params</a> <var>fetchParams</var> and an optional boolean <var>recursive</var> (default false), run these steps: 
    <ol>
     <li>Let <var>request</var> be <var>fetchParams</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#fetch-params-request" id="ref-for-fetch-params-request②">request</a>.
     <li>Let <var>response</var> be <code>null</code>.
     <li value="22">
       If <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-integrity-metadata" id="ref-for-concept-request-integrity-metadata">integrity metadata</a> is not the empty string, then: 
      <ol>
       <li>...
      </ol>
     <li>
      <ins> If the result of executing <a data-link-type="dfn" href="#verify-the-integrity-of-a-response" id="ref-for-verify-the-integrity-of-a-response">verify the integrity of a response</a> given <var>request</var> and <var>response</var> is "<code>invalid</code>", then run <a href="https://fetch.spec.whatwg.org/#fetch-finale">fetch response
    handover</a> given <var>fetchParams</var> and a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error" id="ref-for-concept-network-error">network error</a>. </ins>
     <li> Otherwise, run <a href="https://fetch.spec.whatwg.org/#fetch-finale">fetch
    response handover</a> given <var>fetchParams</var> and <var>response</var>. 
    </ol>
   </div>
   <p class="note" role="note"><span class="marker">NOTE:</span> Ideally we would integrate integrity verification with <a data-link-type="biblio" href="#biblio-sri" title="Subresource Integrity">[SRI]</a>'s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-integrity-metadata" id="ref-for-concept-request-integrity-metadata①">integrity metadata</a> and its supporting algorithms. That would require a
non-trivial refactoring of how the <a data-link-type="biblio" href="#biblio-sri" title="Subresource Integrity">[SRI]</a> specification handles <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-integrity-metadata" id="ref-for-concept-request-integrity-metadata②">integrity metadata</a> strings, which may be worth pursuing in the future.</p>
   <h3 class="heading settled" data-level="3.4" id="monkey-webidl"><span class="secno">3.4. </span><span class="content">WebIDL</span><a class="self-link" href="#monkey-webidl"></a></h3>
   <p>In WebIDL, we’ll define the <code>[IsolatedContext]</code> attribute, and wire it up to
the hook created in HTML above:</p>
   <h4 class="heading settled dfn-paneled idl-code" data-dfn-type="extended-attribute" data-export data-level="3.4.1" data-lt="IsolatedContext" id="IsolatedContext"><span class="secno">3.4.1. </span><span class="content"> [IsolatedContext] </span><a class="self-link" href="#IsolatedContext" id="ref-for-IsolatedContext"></a></h4>
   <p>If the [<code class="idl"><a data-link-type="idl" href="#IsolatedContext" id="ref-for-IsolatedContext①⓪">IsolatedContext</a></code>] <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-extended-attribute" id="ref-for-dfn-extended-attribute">extended attribute</a> appears on an <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-interface" id="ref-for-dfn-interface">interface</a>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-partial-interface" id="ref-for-dfn-partial-interface">partial interface</a>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#interface-mixin" id="ref-for-interface-mixin">interface mixin</a>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#partial-interface-mixin" id="ref-for-partial-interface-mixin">partial interface mixin</a>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-callback-interface" id="ref-for-dfn-callback-interface">callback interface</a>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-namespace" id="ref-for-dfn-namespace">namespace</a>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-partial-namespace" id="ref-for-dfn-partial-namespace">partial namespace</a>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-interface-member" id="ref-for-dfn-interface-member">interface member</a>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#interface-mixin-member" id="ref-for-interface-mixin-member">interface mixin member</a>, or <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-namespace-member" id="ref-for-dfn-namespace-member">namespace member</a>,
it indicates that the construct is <a data-link-type="dfn" href="#dfn-exposed" id="ref-for-dfn-exposed">exposed</a> only within an <a data-link-type="dfn" href="#isolated-context" id="ref-for-isolated-context">isolated context</a>.
The [<code class="idl"><a data-link-type="idl" href="#IsolatedContext" id="ref-for-IsolatedContext①">IsolatedContext</a></code>] extended attribute must not be used
on any other construct.</p>
   <p>The [<code class="idl"><a data-link-type="idl" href="#IsolatedContext" id="ref-for-IsolatedContext②">IsolatedContext</a></code>] extended attribute must <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-xattr-no-arguments" id="ref-for-dfn-xattr-no-arguments">take no arguments</a>.</p>
   <p>If [<code class="idl"><a data-link-type="idl" href="#IsolatedContext" id="ref-for-IsolatedContext③">IsolatedContext</a></code>] appears on an <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-overloaded" id="ref-for-dfn-overloaded">overloaded</a> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-operation" id="ref-for-dfn-operation">operation</a>,
then it must appear on all overloads.</p>
   <p>The [<code class="idl"><a data-link-type="idl" href="#IsolatedContext" id="ref-for-IsolatedContext④">IsolatedContext</a></code>] <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-extended-attribute" id="ref-for-dfn-extended-attribute①">extended attribute</a> must not be specified on more
than one of the following:</p>
   <ul>
    <li data-md>
     <p>an <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-interface-member" id="ref-for-dfn-interface-member①">interface member</a> and its <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-interface" id="ref-for-dfn-interface①">interface</a> or <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-partial-interface" id="ref-for-dfn-partial-interface①">partial interface</a>;</p>
    <li data-md>
     <p>an <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#interface-mixin-member" id="ref-for-interface-mixin-member①">interface mixin member</a> and its <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#interface-mixin" id="ref-for-interface-mixin①">interface mixin</a> or <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#partial-interface-mixin" id="ref-for-partial-interface-mixin①">partial interface mixin</a>;</p>
    <li data-md>
     <p>a <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-namespace-member" id="ref-for-dfn-namespace-member①">namespace member</a> and its <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-namespace" id="ref-for-dfn-namespace①">namespace</a> or <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-partial-namespace" id="ref-for-dfn-partial-namespace①">partial namespace</a>.</p>
   </ul>
   <p class="note" role="note"><span class="marker">Note:</span> This is because adding the [<code class="idl"><a data-link-type="idl" href="#IsolatedContext" id="ref-for-IsolatedContext⑤">IsolatedContext</a></code>] <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-extended-attribute" id="ref-for-dfn-extended-attribute②">extended attribute</a> on a <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-member" id="ref-for-dfn-member">member</a> when its containing definition is also annotated with the
[<code class="idl"><a data-link-type="idl" href="#IsolatedContext" id="ref-for-IsolatedContext⑥">IsolatedContext</a></code>] <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-extended-attribute" id="ref-for-dfn-extended-attribute③">extended attribute</a> does not further restrict the
exposure of the <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-member" id="ref-for-dfn-member①">member</a>.</p>
   <p>An <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-interface" id="ref-for-dfn-interface②">interface</a> without the [<code class="idl"><a data-link-type="idl" href="#IsolatedContext" id="ref-for-IsolatedContext⑦">IsolatedContext</a></code>] <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-extended-attribute" id="ref-for-dfn-extended-attribute④">extended attribute</a> must not <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-inherit" id="ref-for-dfn-inherit">inherit</a> from another interface
that does specify [<code class="idl"><a data-link-type="idl" href="#IsolatedContext" id="ref-for-IsolatedContext⑧">IsolatedContext</a></code>].</p>
   <h4 class="heading settled" data-level="3.4.2" id="monkey-webidl-exposed"><span class="secno">3.4.2. </span><span class="content">Patches to the "exposed" algorithm</span><a class="self-link" href="#monkey-webidl-exposed"></a></h4>
   <p>WebIDL’s <a data-link-type="dfn" href="#dfn-exposed" id="ref-for-dfn-exposed①">exposed</a> algorithm is adjusted as follows, adding a single step
after similarly handling [<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#CrossOriginIsolated" id="ref-for-CrossOriginIsolated">CrossOriginIsolated</a></code>] (step 4 below).</p>
   <div class="algorithm" data-algorithm="exposed">
     An <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-interface" id="ref-for-dfn-interface③">interface</a>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-callback-interface" id="ref-for-dfn-callback-interface①">callback interface</a>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-namespace" id="ref-for-dfn-namespace②">namespace</a>, or <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-member" id="ref-for-dfn-member②">member</a> <var>construct</var> is <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="dfn-exposed">exposed</dfn> in a given <a data-link-type="dfn" href="https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#realm" id="ref-for-realm">realm</a> <var>realm</var> if the following steps return true: 
    <ol>
     <li> If <var>construct</var>’s <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-exposure-set" id="ref-for-dfn-exposure-set">exposure set</a> is not <code>*</code>, and <var>realm</var>.[[GlobalObject]] does not implement an <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-interface" id="ref-for-dfn-interface④">interface</a> that is in <var>construct</var>’s <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-exposure-set" id="ref-for-dfn-exposure-set①">exposure set</a>, then return false. 
     <li> If <var>realm</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-settings-object" id="ref-for-concept-realm-settings-object">settings object</a> is not a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#secure-context" id="ref-for-secure-context②">secure context</a>, and <var>construct</var> is <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-conditionally-exposed" id="ref-for-dfn-conditionally-exposed">conditionally exposed</a> on [<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext">SecureContext</a></code>], then
      return false. 
     <li> If <var>realm</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-settings-object" id="ref-for-concept-realm-settings-object①">settings object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-cross-origin-isolated-capability" id="ref-for-concept-settings-object-cross-origin-isolated-capability③">cross-origin isolated capability</a> is false,
      and <var>construct</var> is <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-conditionally-exposed" id="ref-for-dfn-conditionally-exposed①">conditionally exposed</a> on [<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#CrossOriginIsolated" id="ref-for-CrossOriginIsolated①">CrossOriginIsolated</a></code>],
      then return false. 
     <li>
      <ins> If <var>realm</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-settings-object" id="ref-for-concept-realm-settings-object②">settings object</a> is not an <a data-link-type="dfn" href="#isolated-context" id="ref-for-isolated-context①">isolated context</a>,
        and <var>construct</var> is <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-conditionally-exposed" id="ref-for-dfn-conditionally-exposed②">conditionally exposed</a> on [<code class="idl"><a data-link-type="idl" href="#IsolatedContext" id="ref-for-IsolatedContext⑨">IsolatedContext</a></code>],
        then return <code>false</code>. </ins>
     <li>Return true.
    </ol>
   </div>
   <h3 class="heading settled" data-level="3.5" id="monkey-storage"><span class="secno">3.5. </span><span class="content">Storage</span><a class="self-link" href="#monkey-storage"></a></h3>
   <p>The <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#obtain-a-storage-key-for-non-storage-purposes" id="ref-for-obtain-a-storage-key-for-non-storage-purposes">obtain a storage key for non-storage purposes</a> algorithm is extended to
require double-keying on all storage belonging to an <a href="https://html.spec.whatwg.org/multipage/webappapis.html#environment"> environment</a> with a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin" id="ref-for-concept-environment-top-level-origin">top-level origin</a> known by the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent⑤">user agent</a> to have
an <a data-link-type="dfn" href="#integrity-verification-algorithm" id="ref-for-integrity-verification-algorithm③">integrity verification algorithm</a>.</p>
   <div class="algorithm" data-algorithm="obtain a storage key for non-storage purposes isolated context">
     To obtain a storage key for non-storage purposes, given an <a href="https://html.spec.whatwg.org/multipage/webappapis.html#environment"> environment</a> <var>environment</var>, run these steps: 
    <ol>
     <li> Let <var>origin</var> be <var>environment</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin②">origin</a> if <var>environment</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object④">environment settings object</a>; otherwise <var>environment</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-creation-url" id="ref-for-concept-environment-creation-url">creation URL</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin③">origin</a>. 
     <li>
      <ins> Let <var>top-level origin</var> be <var>environment</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin" id="ref-for-concept-environment-top-level-origin①">top-level origin</a>. </ins>
     <li>
      <ins> If the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent⑥">user agent</a>'s <a data-link-type="dfn" href="#origin-integrity-verification-map" id="ref-for-origin-integrity-verification-map④">origin integrity verification map</a> [<var>top-level origin</var>] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists②">exists</a>, return a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#tuple" id="ref-for-tuple">tuple</a> consisting of <var>top-level origin</var> and <var>origin</var>. </ins>
     <li> Return a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#tuple" id="ref-for-tuple①">tuple</a> consisting of <var>origin</var>. 
    </ol>
   </div>
   <p class="note" role="note"><span class="marker">Note:</span> This is essentially a minimally-specified version of <a href="https://privacycg.github.io/storage-partitioning/"> Client-Side Storage Partitioning</a>. When that is fully specified and merged
into the necessary specifications, those changes will supersede this section,
and it can be removed.</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
  </div>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#dfn-exposed">exposed</a><span>, in § 3.4.2</span>
   <li><a href="#integrity-verification-algorithm">integrity verification algorithm</a><span>, in § 3.2.1</span>
   <li><a href="#isolated-context">isolated context</a><span>, in § 3.2.2</span>
   <li><a href="#IsolatedContext">IsolatedContext</a><span>, in § 3.4</span>
   <li><a href="#isolated-contexts">Isolated Contexts</a><span>, in § 1</span>
   <li><a href="#monkey-main-fetch">main fetch</a><span>, in § 3.3.2</span>
   <li>
    meaningfully mitigate injection attacks
    <ul>
     <li><a href="#csp-list-meaningfully-mitigate-injection-attacks">dfn for CSP list</a><span>, in § 3.1.1</span>
     <li><a href="#environment-settings-object-meaningfully-mitigate-injection-attacks">dfn for environment settings object</a><span>, in § 3.2.2</span>
    </ul>
   <li><a href="#csp-list-meaningfully-mitigate-ui-redressing-attacks">meaningfully mitigate UI Redressing attacks</a><span>, in § 3.1.10</span>
   <li><a href="#csp-list-meaningfully-mitigate-injection-attacks">mitigate-injection</a><span>, in § 3.1.1</span>
   <li><a href="#csp-list-meaningfully-mitigate-ui-redressing-attacks">mitigate-ui-redressing</a><span>, in § 3.1.10</span>
   <li><a href="#environment-settings-object-mitigate-ui-redressing-attacks">mitigate UI Redressing attacks</a><span>, in § 3.2.2</span>
   <li><a href="#abstract-opdef-obtain-directive">obtain-directive</a><span>, in § 3.1.2</span>
   <li><a href="#origin-integrity-verification-map">origin integrity verification map</a><span>, in § 3.2.1</span>
   <li><a href="#policy-sufficiently-blocks-insecure-subresources">sufficiently blocks insecure subresources</a><span>, in § 3.1.7</span>
   <li><a href="#policy-sufficiently-mitigates-dom-sinks">sufficiently mitigates DOM sinks</a><span>, in § 3.1.8</span>
   <li><a href="#policy-sufficiently-mitigates-plugins">sufficiently mitigates plugins</a><span>, in § 3.1.3</span>
   <li><a href="#policy-sufficiently-mitigates-relative-url-manipulation">sufficiently mitigates relative URL manipulation</a><span>, in § 3.1.4</span>
   <li><a href="#policy-sufficiently-mitigates-script-execution">sufficiently mitigates script execution</a><span>, in § 3.1.5</span>
   <li><a href="#policy-sufficiently-mitigates-style-evaluation">sufficiently mitigates style evaluation</a><span>, in § 3.1.6</span>
   <li><a href="#verify-the-integrity-of-a-response">verify the integrity of a response</a><span>, in § 3.3.1</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[CSP]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="f1dafdec">'none'</span>
     <li><span class="dfn-paneled" id="233e6d44">'self'</span>
     <li><span class="dfn-paneled" id="42cf61e0">'unsafe-inline'</span>
     <li><span class="dfn-paneled" id="a23fd68c">'wasm-unsafe-eval'</span>
     <li><span class="dfn-paneled" id="76a07ab2">Get fetch directive fallback list</span>
     <li><span class="dfn-paneled" id="78b596f6">csp list</span>
     <li><span class="dfn-paneled" id="3d7ed2c2">directive set</span>
     <li><span class="dfn-paneled" id="c80aa797">directives</span>
     <li><span class="dfn-paneled" id="4582ec82">disposition</span>
     <li><span class="dfn-paneled" id="51218496">name</span>
     <li><span class="dfn-paneled" id="de921304">policy</span>
     <li><span class="dfn-paneled" id="54872557">source</span>
     <li><span class="dfn-paneled" id="b36452d7">source expression</span>
     <li><span class="dfn-paneled" id="461b765a">value</span>
    </ul>
   <li>
    <a data-link-type="biblio">[ECMASCRIPT]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a5f015e3">realm</span>
    </ul>
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="81a76425">body</span>
     <li><span class="dfn-paneled" id="857d5516">client</span>
     <li><span class="dfn-paneled" id="a33db89a">fetch</span>
     <li><span class="dfn-paneled" id="97aa4684">fetch params</span>
     <li><span class="dfn-paneled" id="d79a826f">integrity metadata</span>
     <li><span class="dfn-paneled" id="eb1b1af3">network error</span>
     <li><span class="dfn-paneled" id="f78d5b5c">origin</span>
     <li><span class="dfn-paneled" id="5695c146">request</span>
     <li><span class="dfn-paneled" id="ee7bba09">response</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="f7f36561">concrete</span>
     <li><span class="dfn-paneled" id="fa5ee9c5">creation url</span>
     <li><span class="dfn-paneled" id="473036cd">cross-origin isolated capability</span>
     <li><span class="dfn-paneled" id="158b3a38">csp list</span>
     <li><span class="dfn-paneled" id="3e12e042">environment settings object</span>
     <li><span class="dfn-paneled" id="8a30477b">global object</span>
     <li><span class="dfn-paneled" id="43ac8374">origin</span>
     <li><span class="dfn-paneled" id="bd1db03d">policy container</span>
     <li><span class="dfn-paneled" id="65181da8">secure context</span>
     <li><span class="dfn-paneled" id="7deb6835">settings object</span>
     <li><span class="dfn-paneled" id="c63519ed">top-level origin</span>
     <li><span class="dfn-paneled" id="1d2aa117">tuple origin</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="7f9469b5">ascii case-insensitive</span>
     <li><span class="dfn-paneled" id="36858240">boolean</span>
     <li><span class="dfn-paneled" id="ae8def21">contain</span>
     <li><span class="dfn-paneled" id="f937b7b6">continue</span>
     <li><span class="dfn-paneled" id="1243a891">exist</span>
     <li><span class="dfn-paneled" id="16d07e10">for each</span>
     <li><span class="dfn-paneled" id="860300d4">implementation-defined</span>
     <li><span class="dfn-paneled" id="3fca5a9e">map</span>
     <li><span class="dfn-paneled" id="0204d188">size</span>
     <li><span class="dfn-paneled" id="0e8de730">tuple</span>
     <li><span class="dfn-paneled" id="6d19ac93">user agent</span>
    </ul>
   <li>
    <a data-link-type="biblio">[STORAGE]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="76919410">obtain a storage key for non-storage purposes</span>
    </ul>
   <li>
    <a data-link-type="biblio">[TRUSTED-TYPES]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="78785dae">require-trusted-types-for-directive</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="cc2141c1">CrossOriginIsolated</span>
     <li><span class="dfn-paneled" id="b75bb3bd">SecureContext</span>
     <li><span class="dfn-paneled" id="b197a79c">callback interface</span>
     <li><span class="dfn-paneled" id="d9659204">conditionally exposed</span>
     <li><span class="dfn-paneled" id="631ad9e6">exposure set</span>
     <li><span class="dfn-paneled" id="3f252540">extended attribute</span>
     <li><span class="dfn-paneled" id="eab3771a">inherit</span>
     <li><span class="dfn-paneled" id="1422ec4e">interface</span>
     <li><span class="dfn-paneled" id="1c84257e">interface member</span>
     <li><span class="dfn-paneled" id="d08c79a9">interface mixin</span>
     <li><span class="dfn-paneled" id="d7a206d7">interface mixin member</span>
     <li><span class="dfn-paneled" id="22e6d952">members</span>
     <li><span class="dfn-paneled" id="2039631f">namespace</span>
     <li><span class="dfn-paneled" id="5be3b9a5">namespace member</span>
     <li><span class="dfn-paneled" id="bac9095f">operation</span>
     <li><span class="dfn-paneled" id="c71e04da">overloaded</span>
     <li><span class="dfn-paneled" id="d0eba3fd">partial interface</span>
     <li><span class="dfn-paneled" id="33e1d425">partial interface mixin</span>
     <li><span class="dfn-paneled" id="2f83c241">partial namespace</span>
     <li><span class="dfn-paneled" id="843fcc5a">takes no arguments</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-csp">[CSP]
   <dd>Mike West; Antonio Sartori. <a href="https://w3c.github.io/webappsec-csp/"><cite>Content Security Policy Level 3</cite></a>. URL: <a href="https://w3c.github.io/webappsec-csp/">https://w3c.github.io/webappsec-csp/</a>
   <dt id="biblio-ecmascript">[ECMASCRIPT]
   <dd><a href="https://tc39.es/ecma262/multipage/"><cite>ECMAScript Language Specification</cite></a>. URL: <a href="https://tc39.es/ecma262/multipage/">https://tc39.es/ecma262/multipage/</a>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/"><cite>Fetch Standard</cite></a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-storage">[STORAGE]
   <dd>Anne van Kesteren. <a href="https://storage.spec.whatwg.org/"><cite>Storage Standard</cite></a>. Living Standard. URL: <a href="https://storage.spec.whatwg.org/">https://storage.spec.whatwg.org/</a>
   <dt id="biblio-trusted-types">[TRUSTED-TYPES]
   <dd>Krzysztof Kotowicz. <a href="https://w3c.github.io/trusted-types/dist/spec/"><cite>Trusted Types</cite></a>. URL: <a href="https://w3c.github.io/trusted-types/dist/spec/">https://w3c.github.io/trusted-types/dist/spec/</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-securer-contexts">[SECURER-CONTEXTS]
   <dd>Mike West. <a href="https://github.com/mikewest/securer-contexts"><cite>Securer Contexts</cite></a>. URL: <a href="https://github.com/mikewest/securer-contexts">https://github.com/mikewest/securer-contexts</a>
   <dt id="biblio-sri">[SRI]
   <dd>Devdatta Akhawe; et al. <a href="https://w3c.github.io/webappsec-subresource-integrity/"><cite>Subresource Integrity</cite></a>. URL: <a href="https://w3c.github.io/webappsec-subresource-integrity/">https://w3c.github.io/webappsec-subresource-integrity/</a>
   <dt id="biblio-strict-csp">[STRICT-CSP]
   <dd>Lukas Weichselbaum. <a href="https://web.dev/strict-csp/"><cite>Mitigate cross-site scripting (XSS) with a strict Content Security Policy (CSP)</cite></a>. 15 March 2021. URL: <a href="https://web.dev/strict-csp/">https://web.dev/strict-csp/</a>
   <dt id="biblio-uisecurity">[UISECURITY]
   <dd>Brad Hill. <a href="https://w3c.github.io/webappsec-uisecurity/index.html"><cite>User Interface Security and the Visibility API</cite></a>. URL: <a href="https://w3c.github.io/webappsec-uisecurity/index.html">https://w3c.github.io/webappsec-uisecurity/index.html</a>
  </dl>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"0204d188": {"dfnID":"0204d188","dfnText":"size","external":true,"refSections":[{"refs":[{"id":"ref-for-list-size"}],"title":"3.1.3. Does a policy sufficiently mitigate plugins?"},{"refs":[{"id":"ref-for-list-size\u2460"}],"title":"3.1.4. Does a policy sufficiently mitigate relative URL manipulation?"},{"refs":[{"id":"ref-for-list-size\u2461"}],"title":"3.1.10. Does a policy meaningfully mitigate UI Redressing attacks?"}],"url":"https://infra.spec.whatwg.org/#list-size"},
"0e8de730": {"dfnID":"0e8de730","dfnText":"tuple","external":true,"refSections":[{"refs":[{"id":"ref-for-tuple"},{"id":"ref-for-tuple\u2460"}],"title":"3.5. Storage"}],"url":"https://infra.spec.whatwg.org/#tuple"},
"1243a891": {"dfnID":"1243a891","dfnText":"exist","external":true,"refSections":[{"refs":[{"id":"ref-for-map-exists"}],"title":"3.2.2. Environment Settings Object properties"},{"refs":[{"id":"ref-for-map-exists\u2460"}],"title":"3.3.1. Verify the integrity of a response"},{"refs":[{"id":"ref-for-map-exists\u2461"}],"title":"3.5. Storage"}],"url":"https://infra.spec.whatwg.org/#map-exists"},
"1422ec4e": {"dfnID":"1422ec4e","dfnText":"interface","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-interface"},{"id":"ref-for-dfn-interface\u2460"},{"id":"ref-for-dfn-interface\u2461"}],"title":"3.4.1. \n  [IsolatedContext]\n"},{"refs":[{"id":"ref-for-dfn-interface\u2462"},{"id":"ref-for-dfn-interface\u2463"}],"title":"3.4.2. Patches to the \"exposed\" algorithm"}],"url":"https://webidl.spec.whatwg.org/#dfn-interface"},
"158b3a38": {"dfnID":"158b3a38","dfnText":"csp list","external":true,"refSections":[{"refs":[{"id":"ref-for-policy-container-csp-list"},{"id":"ref-for-policy-container-csp-list\u2460"}],"title":"3.2.2. Environment Settings Object properties"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#policy-container-csp-list"},
"16d07e10": {"dfnID":"16d07e10","dfnText":"for each","external":true,"refSections":[{"refs":[{"id":"ref-for-list-iterate"}],"title":"3.1.1. Does a policy meaningfully mitigate injection attacks?"},{"refs":[{"id":"ref-for-list-iterate\u2460"}],"title":"3.1.2. Obtain the active directive for a type"},{"refs":[{"id":"ref-for-list-iterate\u2461"}],"title":"3.1.4. Does a policy sufficiently mitigate relative URL manipulation?"},{"refs":[{"id":"ref-for-list-iterate\u2462"}],"title":"3.1.6. Does a policy sufficiently mitigate style evaluation?"},{"refs":[{"id":"ref-for-list-iterate\u2463"}],"title":"3.1.7. Does a policy sufficiently block insecure subresources?"},{"refs":[{"id":"ref-for-list-iterate\u2464"}],"title":"3.1.8. Does a policy sufficiently mitigate DOM sinks?"},{"refs":[{"id":"ref-for-list-iterate\u2465"},{"id":"ref-for-list-iterate\u2466"}],"title":"3.1.10. Does a policy meaningfully mitigate UI Redressing attacks?"}],"url":"https://infra.spec.whatwg.org/#list-iterate"},
"1c84257e": {"dfnID":"1c84257e","dfnText":"interface member","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-interface-member"},{"id":"ref-for-dfn-interface-member\u2460"}],"title":"3.4.1. \n  [IsolatedContext]\n"}],"url":"https://webidl.spec.whatwg.org/#dfn-interface-member"},
"1d2aa117": {"dfnID":"1d2aa117","dfnText":"tuple origin","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-origin-tuple"}],"title":"3.2.1. Integrity"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-tuple"},
"2039631f": {"dfnID":"2039631f","dfnText":"namespace","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-namespace"},{"id":"ref-for-dfn-namespace\u2460"}],"title":"3.4.1. \n  [IsolatedContext]\n"},{"refs":[{"id":"ref-for-dfn-namespace\u2461"}],"title":"3.4.2. Patches to the \"exposed\" algorithm"}],"url":"https://webidl.spec.whatwg.org/#dfn-namespace"},
"22e6d952": {"dfnID":"22e6d952","dfnText":"members","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-member"},{"id":"ref-for-dfn-member\u2460"}],"title":"3.4.1. \n  [IsolatedContext]\n"},{"refs":[{"id":"ref-for-dfn-member\u2461"}],"title":"3.4.2. Patches to the \"exposed\" algorithm"}],"url":"https://webidl.spec.whatwg.org/#dfn-member"},
"233e6d44": {"dfnID":"233e6d44","dfnText":"'self'","external":true,"refSections":[{"refs":[{"id":"ref-for-grammardef-self"}],"title":"3.1.4. Does a policy sufficiently mitigate relative URL manipulation?"},{"refs":[{"id":"ref-for-grammardef-self\u2460"}],"title":"3.1.5. Does a policy sufficiently mitigate script execution?"},{"refs":[{"id":"ref-for-grammardef-self\u2461"}],"title":"3.1.6. Does a policy sufficiently mitigate style evaluation?"},{"refs":[{"id":"ref-for-grammardef-self\u2462"}],"title":"3.1.7. Does a policy sufficiently block insecure subresources?"},{"refs":[{"id":"ref-for-grammardef-self\u2463"}],"title":"3.1.10. Does a policy meaningfully mitigate UI Redressing attacks?"}],"url":"https://w3c.github.io/webappsec-csp/#grammardef-self"},
"2f83c241": {"dfnID":"2f83c241","dfnText":"partial namespace","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-partial-namespace"},{"id":"ref-for-dfn-partial-namespace\u2460"}],"title":"3.4.1. \n  [IsolatedContext]\n"}],"url":"https://webidl.spec.whatwg.org/#dfn-partial-namespace"},
"33e1d425": {"dfnID":"33e1d425","dfnText":"partial interface mixin","external":true,"refSections":[{"refs":[{"id":"ref-for-partial-interface-mixin"},{"id":"ref-for-partial-interface-mixin\u2460"}],"title":"3.4.1. \n  [IsolatedContext]\n"}],"url":"https://webidl.spec.whatwg.org/#partial-interface-mixin"},
"36858240": {"dfnID":"36858240","dfnText":"boolean","external":true,"refSections":[{"refs":[{"id":"ref-for-boolean"}],"title":"3.1.1. Does a policy meaningfully mitigate injection attacks?"},{"refs":[{"id":"ref-for-boolean\u2460"}],"title":"3.2.1. Integrity"}],"url":"https://infra.spec.whatwg.org/#boolean"},
"3d7ed2c2": {"dfnID":"3d7ed2c2","dfnText":"directive set","external":true,"refSections":[{"refs":[{"id":"ref-for-policy-directive-set"}],"title":"3.1.2. Obtain the active directive for a type"},{"refs":[{"id":"ref-for-policy-directive-set\u2460"}],"title":"3.1.4. Does a policy sufficiently mitigate relative URL manipulation?"},{"refs":[{"id":"ref-for-policy-directive-set\u2461"}],"title":"3.1.6. Does a policy sufficiently mitigate style evaluation?"},{"refs":[{"id":"ref-for-policy-directive-set\u2462"}],"title":"3.1.8. Does a policy sufficiently mitigate DOM sinks?"},{"refs":[{"id":"ref-for-policy-directive-set\u2463"}],"title":"3.1.10. Does a policy meaningfully mitigate UI Redressing attacks?"}],"url":"https://w3c.github.io/webappsec-csp/#policy-directive-set"},
"3e12e042": {"dfnID":"3e12e042","dfnText":"environment settings object","external":true,"refSections":[{"refs":[{"id":"ref-for-environment-settings-object"}],"title":"3.2. HTML"},{"refs":[{"id":"ref-for-environment-settings-object\u2460"},{"id":"ref-for-environment-settings-object\u2461"},{"id":"ref-for-environment-settings-object\u2462"}],"title":"3.2.2. Environment Settings Object properties"},{"refs":[{"id":"ref-for-environment-settings-object\u2463"}],"title":"3.5. Storage"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object"},
"3f252540": {"dfnID":"3f252540","dfnText":"extended attribute","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-extended-attribute"},{"id":"ref-for-dfn-extended-attribute\u2460"},{"id":"ref-for-dfn-extended-attribute\u2461"},{"id":"ref-for-dfn-extended-attribute\u2462"},{"id":"ref-for-dfn-extended-attribute\u2463"}],"title":"3.4.1. \n  [IsolatedContext]\n"}],"url":"https://webidl.spec.whatwg.org/#dfn-extended-attribute"},
"3fca5a9e": {"dfnID":"3fca5a9e","dfnText":"map","external":true,"refSections":[{"refs":[{"id":"ref-for-ordered-map"}],"title":"3.2.1. Integrity"}],"url":"https://infra.spec.whatwg.org/#ordered-map"},
"42cf61e0": {"dfnID":"42cf61e0","dfnText":"'unsafe-inline'","external":true,"refSections":[{"refs":[{"id":"ref-for-grammardef-unsafe-inline"}],"title":"3.1.6. Does a policy sufficiently mitigate style evaluation?"}],"url":"https://w3c.github.io/webappsec-csp/#grammardef-unsafe-inline"},
"43ac8374": {"dfnID":"43ac8374","dfnText":"origin","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-settings-object-origin"}],"title":"3. Monkey Patches"},{"refs":[{"id":"ref-for-concept-settings-object-origin\u2460"}],"title":"3.2.2. Environment Settings Object properties"},{"refs":[{"id":"ref-for-concept-settings-object-origin\u2461"},{"id":"ref-for-concept-settings-object-origin\u2462"}],"title":"3.5. Storage"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin"},
"4582ec82": {"dfnID":"4582ec82","dfnText":"disposition","external":true,"refSections":[{"refs":[{"id":"ref-for-policy-disposition"}],"title":"3.1.1. Does a policy meaningfully mitigate injection attacks?"},{"refs":[{"id":"ref-for-policy-disposition\u2460"}],"title":"3.1.10. Does a policy meaningfully mitigate UI Redressing attacks?"}],"url":"https://w3c.github.io/webappsec-csp/#policy-disposition"},
"461b765a": {"dfnID":"461b765a","dfnText":"value","external":true,"refSections":[{"refs":[{"id":"ref-for-directive-value"},{"id":"ref-for-directive-value\u2460"}],"title":"3.1.3. Does a policy sufficiently mitigate plugins?"},{"refs":[{"id":"ref-for-directive-value\u2461"},{"id":"ref-for-directive-value\u2462"}],"title":"3.1.4. Does a policy sufficiently mitigate relative URL manipulation?"},{"refs":[{"id":"ref-for-directive-value\u2463"}],"title":"3.1.8. Does a policy sufficiently mitigate DOM sinks?"},{"refs":[{"id":"ref-for-directive-value\u2464"},{"id":"ref-for-directive-value\u2465"}],"title":"3.1.10. Does a policy meaningfully mitigate UI Redressing attacks?"}],"url":"https://w3c.github.io/webappsec-csp/#directive-value"},
"473036cd": {"dfnID":"473036cd","dfnText":"cross-origin isolated capability","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-settings-object-cross-origin-isolated-capability"}],"title":"1. Introduction"},{"refs":[{"id":"ref-for-concept-settings-object-cross-origin-isolated-capability\u2460"}],"title":"3. Monkey Patches"},{"refs":[{"id":"ref-for-concept-settings-object-cross-origin-isolated-capability\u2461"}],"title":"3.2.2. Environment Settings Object properties"},{"refs":[{"id":"ref-for-concept-settings-object-cross-origin-isolated-capability\u2462"}],"title":"3.4.2. Patches to the \"exposed\" algorithm"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-cross-origin-isolated-capability"},
"51218496": {"dfnID":"51218496","dfnText":"name","external":true,"refSections":[{"refs":[{"id":"ref-for-directive-name"}],"title":"3.1.2. Obtain the active directive for a type"},{"refs":[{"id":"ref-for-directive-name\u2460"}],"title":"3.1.4. Does a policy sufficiently mitigate relative URL manipulation?"},{"refs":[{"id":"ref-for-directive-name\u2461"}],"title":"3.1.6. Does a policy sufficiently mitigate style evaluation?"},{"refs":[{"id":"ref-for-directive-name\u2462"}],"title":"3.1.8. Does a policy sufficiently mitigate DOM sinks?"},{"refs":[{"id":"ref-for-directive-name\u2463"}],"title":"3.1.10. Does a policy meaningfully mitigate UI Redressing attacks?"}],"url":"https://w3c.github.io/webappsec-csp/#directive-name"},
"54872557": {"dfnID":"54872557","dfnText":"source","external":true,"refSections":[{"refs":[{"id":"ref-for-policy-source"}],"title":"3.1.1. Does a policy meaningfully mitigate injection attacks?"},{"refs":[{"id":"ref-for-policy-source\u2460"}],"title":"3.1.10. Does a policy meaningfully mitigate UI Redressing attacks?"}],"url":"https://w3c.github.io/webappsec-csp/#policy-source"},
"5695c146": {"dfnID":"5695c146","dfnText":"request","external":true,"refSections":[{"refs":[{"id":"ref-for-fetch-params-request"}],"title":"3.2.1. Integrity"},{"refs":[{"id":"ref-for-fetch-params-request\u2460"}],"title":"3.3.1. Verify the integrity of a response"},{"refs":[{"id":"ref-for-fetch-params-request\u2461"}],"title":"3.3.2. Patches to the \"Main Fetch\" algorithm"}],"url":"https://fetch.spec.whatwg.org/#fetch-params-request"},
"5be3b9a5": {"dfnID":"5be3b9a5","dfnText":"namespace member","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-namespace-member"},{"id":"ref-for-dfn-namespace-member\u2460"}],"title":"3.4.1. \n  [IsolatedContext]\n"}],"url":"https://webidl.spec.whatwg.org/#dfn-namespace-member"},
"631ad9e6": {"dfnID":"631ad9e6","dfnText":"exposure set","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-exposure-set"},{"id":"ref-for-dfn-exposure-set\u2460"}],"title":"3.4.2. Patches to the \"exposed\" algorithm"}],"url":"https://webidl.spec.whatwg.org/#dfn-exposure-set"},
"65181da8": {"dfnID":"65181da8","dfnText":"secure context","external":true,"refSections":[{"refs":[{"id":"ref-for-secure-context"}],"title":"1. Introduction"},{"refs":[{"id":"ref-for-secure-context\u2460"}],"title":"3. Monkey Patches"},{"refs":[{"id":"ref-for-secure-context\u2461"}],"title":"3.4.2. Patches to the \"exposed\" algorithm"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#secure-context"},
"6d19ac93": {"dfnID":"6d19ac93","dfnText":"user agent","external":true,"refSections":[{"refs":[{"id":"ref-for-user-agent"}],"title":"3. Monkey Patches"},{"refs":[{"id":"ref-for-user-agent\u2460"}],"title":"3.2.1. Integrity"},{"refs":[{"id":"ref-for-user-agent\u2461"}],"title":"3.2.2. Environment Settings Object properties"},{"refs":[{"id":"ref-for-user-agent\u2462"},{"id":"ref-for-user-agent\u2463"}],"title":"3.3.1. Verify the integrity of a response"},{"refs":[{"id":"ref-for-user-agent\u2464"},{"id":"ref-for-user-agent\u2465"}],"title":"3.5. Storage"}],"url":"https://infra.spec.whatwg.org/#user-agent"},
"76919410": {"dfnID":"76919410","dfnText":"obtain a storage key for non-storage purposes","external":true,"refSections":[{"refs":[{"id":"ref-for-obtain-a-storage-key-for-non-storage-purposes"}],"title":"3.5. Storage"}],"url":"https://storage.spec.whatwg.org/#obtain-a-storage-key-for-non-storage-purposes"},
"76a07ab2": {"dfnID":"76a07ab2","dfnText":"Get fetch directive fallback list","external":true,"refSections":[{"refs":[{"id":"ref-for-directive-fallback-list"}],"title":"3.1.2. Obtain the active directive for a type"}],"url":"https://w3c.github.io/webappsec-csp/#directive-fallback-list"},
"78785dae": {"dfnID":"78785dae","dfnText":"require-trusted-types-for-directive","external":true,"refSections":[{"refs":[{"id":"ref-for-require-trusted-types-for-directive"}],"title":"3.1.8. Does a policy sufficiently mitigate DOM sinks?"}],"url":"https://w3c.github.io/trusted-types/dist/spec/#require-trusted-types-for-directive"},
"78b596f6": {"dfnID":"78b596f6","dfnText":"csp list","external":true,"refSections":[{"refs":[{"id":"ref-for-csp-list"}],"title":"3.1. Content Security Policy"},{"refs":[{"id":"ref-for-csp-list\u2460"}],"title":"3.1.1. Does a policy meaningfully mitigate injection attacks?"},{"refs":[{"id":"ref-for-csp-list\u2461"}],"title":"3.1.10. Does a policy meaningfully mitigate UI Redressing attacks?"}],"url":"https://w3c.github.io/webappsec-csp/#csp-list"},
"7deb6835": {"dfnID":"7deb6835","dfnText":"settings object","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-realm-settings-object"},{"id":"ref-for-concept-realm-settings-object\u2460"},{"id":"ref-for-concept-realm-settings-object\u2461"}],"title":"3.4.2. Patches to the \"exposed\" algorithm"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-settings-object"},
"7f9469b5": {"dfnID":"7f9469b5","dfnText":"ascii case-insensitive","external":true,"refSections":[{"refs":[{"id":"ref-for-ascii-case-insensitive"}],"title":"3.1.3. Does a policy sufficiently mitigate plugins?"},{"refs":[{"id":"ref-for-ascii-case-insensitive\u2460"}],"title":"3.1.4. Does a policy sufficiently mitigate relative URL manipulation?"},{"refs":[{"id":"ref-for-ascii-case-insensitive\u2461"}],"title":"3.1.5. Does a policy sufficiently mitigate script execution?"},{"refs":[{"id":"ref-for-ascii-case-insensitive\u2462"}],"title":"3.1.6. Does a policy sufficiently mitigate style evaluation?"},{"refs":[{"id":"ref-for-ascii-case-insensitive\u2463"}],"title":"3.1.7. Does a policy sufficiently block insecure subresources?"},{"refs":[{"id":"ref-for-ascii-case-insensitive\u2464"}],"title":"3.1.8. Does a policy sufficiently mitigate DOM sinks?"},{"refs":[{"id":"ref-for-ascii-case-insensitive\u2465"}],"title":"3.1.10. Does a policy meaningfully mitigate UI Redressing attacks?"}],"url":"https://infra.spec.whatwg.org/#ascii-case-insensitive"},
"81a76425": {"dfnID":"81a76425","dfnText":"body","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-response-body"}],"title":"3.3.1. Verify the integrity of a response"}],"url":"https://fetch.spec.whatwg.org/#concept-response-body"},
"843fcc5a": {"dfnID":"843fcc5a","dfnText":"takes no arguments","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-xattr-no-arguments"}],"title":"3.4.1. \n  [IsolatedContext]\n"}],"url":"https://webidl.spec.whatwg.org/#dfn-xattr-no-arguments"},
"857d5516": {"dfnID":"857d5516","dfnText":"client","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-client"}],"title":"3.3.1. Verify the integrity of a response"}],"url":"https://fetch.spec.whatwg.org/#concept-request-client"},
"860300d4": {"dfnID":"860300d4","dfnText":"implementation-defined","external":true,"refSections":[{"refs":[{"id":"ref-for-implementation-defined"}],"title":"3.2.1. Integrity"}],"url":"https://infra.spec.whatwg.org/#implementation-defined"},
"8a30477b": {"dfnID":"8a30477b","dfnText":"global object","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-settings-object-global"}],"title":"3.2. HTML"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global"},
"97aa4684": {"dfnID":"97aa4684","dfnText":"fetch params","external":true,"refSections":[{"refs":[{"id":"ref-for-fetch-params"}],"title":"3.3.2. Patches to the \"Main Fetch\" algorithm"}],"url":"https://fetch.spec.whatwg.org/#fetch-params"},
"IsolatedContext": {"dfnID":"IsolatedContext","dfnText":"3.4.1. \n  [IsolatedContext]\n","external":false,"refSections":[{"refs":[{"id":"ref-for-IsolatedContext"},{"id":"ref-for-IsolatedContext"},{"id":"ref-for-IsolatedContext\u2460"},{"id":"ref-for-IsolatedContext\u2461"},{"id":"ref-for-IsolatedContext\u2462"},{"id":"ref-for-IsolatedContext\u2463"},{"id":"ref-for-IsolatedContext\u2464"},{"id":"ref-for-IsolatedContext\u2465"},{"id":"ref-for-IsolatedContext\u2466"},{"id":"ref-for-IsolatedContext\u2467"}],"title":"3.4.1. \n  [IsolatedContext]\n"},{"refs":[{"id":"ref-for-IsolatedContext\u2468"}],"title":"3.4.2. Patches to the \"exposed\" algorithm"}],"url":"#IsolatedContext"},
"a23fd68c": {"dfnID":"a23fd68c","dfnText":"'wasm-unsafe-eval'","external":true,"refSections":[{"refs":[{"id":"ref-for-grammardef-wasm-unsafe-eval"}],"title":"3.1.5. Does a policy sufficiently mitigate script execution?"}],"url":"https://w3c.github.io/webappsec-csp/#grammardef-wasm-unsafe-eval"},
"a33db89a": {"dfnID":"a33db89a","dfnText":"fetch","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-fetch"}],"title":"3. Monkey Patches"}],"url":"https://fetch.spec.whatwg.org/#concept-fetch"},
"a5f015e3": {"dfnID":"a5f015e3","dfnText":"realm","external":true,"refSections":[{"refs":[{"id":"ref-for-realm"}],"title":"3.4.2. Patches to the \"exposed\" algorithm"}],"url":"https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#realm"},
"abstract-opdef-obtain-directive": {"dfnID":"abstract-opdef-obtain-directive","dfnText":"obtain\nthe active directive","external":false,"refSections":[{"refs":[{"id":"ref-for-abstract-opdef-obtain-directive"}],"title":"3.1.3. Does a policy sufficiently mitigate plugins?"},{"refs":[{"id":"ref-for-abstract-opdef-obtain-directive\u2460"}],"title":"3.1.5. Does a policy sufficiently mitigate script execution?"},{"refs":[{"id":"ref-for-abstract-opdef-obtain-directive\u2461"}],"title":"3.1.6. Does a policy sufficiently mitigate style evaluation?"},{"refs":[{"id":"ref-for-abstract-opdef-obtain-directive\u2462"}],"title":"3.1.7. Does a policy sufficiently block insecure subresources?"}],"url":"#abstract-opdef-obtain-directive"},
"ae8def21": {"dfnID":"ae8def21","dfnText":"contain","external":true,"refSections":[{"refs":[{"id":"ref-for-list-contain"}],"title":"3.1.2. Obtain the active directive for a type"},{"refs":[{"id":"ref-for-list-contain\u2460"}],"title":"3.1.8. Does a policy sufficiently mitigate DOM sinks?"}],"url":"https://infra.spec.whatwg.org/#list-contain"},
"b197a79c": {"dfnID":"b197a79c","dfnText":"callback interface","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-callback-interface"}],"title":"3.4.1. \n  [IsolatedContext]\n"},{"refs":[{"id":"ref-for-dfn-callback-interface\u2460"}],"title":"3.4.2. Patches to the \"exposed\" algorithm"}],"url":"https://webidl.spec.whatwg.org/#dfn-callback-interface"},
"b36452d7": {"dfnID":"b36452d7","dfnText":"source expression","external":true,"refSections":[{"refs":[{"id":"ref-for-source-expression"}],"title":"3.1.5. Does a policy sufficiently mitigate script execution?"},{"refs":[{"id":"ref-for-source-expression\u2460"}],"title":"3.1.6. Does a policy sufficiently mitigate style evaluation?"},{"refs":[{"id":"ref-for-source-expression\u2461"}],"title":"3.1.7. Does a policy sufficiently block insecure subresources?"}],"url":"https://w3c.github.io/webappsec-csp/#source-expression"},
"b75bb3bd": {"dfnID":"b75bb3bd","dfnText":"SecureContext","external":true,"refSections":[{"refs":[{"id":"ref-for-SecureContext"}],"title":"3.4.2. Patches to the \"exposed\" algorithm"}],"url":"https://webidl.spec.whatwg.org/#SecureContext"},
"bac9095f": {"dfnID":"bac9095f","dfnText":"operation","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-operation"}],"title":"3.4.1. \n  [IsolatedContext]\n"}],"url":"https://webidl.spec.whatwg.org/#dfn-operation"},
"bd1db03d": {"dfnID":"bd1db03d","dfnText":"policy container","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-settings-object-policy-container"},{"id":"ref-for-concept-settings-object-policy-container\u2460"}],"title":"3.2.2. Environment Settings Object properties"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-policy-container"},
"c63519ed": {"dfnID":"c63519ed","dfnText":"top-level origin","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-environment-top-level-origin"},{"id":"ref-for-concept-environment-top-level-origin\u2460"}],"title":"3.5. Storage"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin"},
"c71e04da": {"dfnID":"c71e04da","dfnText":"overloaded","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-overloaded"}],"title":"3.4.1. \n  [IsolatedContext]\n"}],"url":"https://webidl.spec.whatwg.org/#dfn-overloaded"},
"c80aa797": {"dfnID":"c80aa797","dfnText":"directives","external":true,"refSections":[{"refs":[{"id":"ref-for-directives"}],"title":"3.1.2. Obtain the active directive for a type"}],"url":"https://w3c.github.io/webappsec-csp/#directives"},
"cc2141c1": {"dfnID":"cc2141c1","dfnText":"CrossOriginIsolated","external":true,"refSections":[{"refs":[{"id":"ref-for-CrossOriginIsolated"},{"id":"ref-for-CrossOriginIsolated\u2460"}],"title":"3.4.2. Patches to the \"exposed\" algorithm"}],"url":"https://webidl.spec.whatwg.org/#CrossOriginIsolated"},
"csp-list-meaningfully-mitigate-injection-attacks": {"dfnID":"csp-list-meaningfully-mitigate-injection-attacks","dfnText":"meaningfully\nmitigate injection attacks","external":false,"refSections":[{"refs":[{"id":"ref-for-csp-list-meaningfully-mitigate-injection-attacks"}],"title":"3.1.9. Example"},{"refs":[{"id":"ref-for-csp-list-meaningfully-mitigate-injection-attacks\u2460"}],"title":"3.2.2. Environment Settings Object properties"}],"url":"#csp-list-meaningfully-mitigate-injection-attacks"},
"csp-list-meaningfully-mitigate-ui-redressing-attacks": {"dfnID":"csp-list-meaningfully-mitigate-ui-redressing-attacks","dfnText":"meaningfully\nmitigate UI Redressing attacks","external":false,"refSections":[{"refs":[{"id":"ref-for-csp-list-meaningfully-mitigate-ui-redressing-attacks"}],"title":"3.2.2. Environment Settings Object properties"}],"url":"#csp-list-meaningfully-mitigate-ui-redressing-attacks"},
"d08c79a9": {"dfnID":"d08c79a9","dfnText":"interface mixin","external":true,"refSections":[{"refs":[{"id":"ref-for-interface-mixin"},{"id":"ref-for-interface-mixin\u2460"}],"title":"3.4.1. \n  [IsolatedContext]\n"}],"url":"https://webidl.spec.whatwg.org/#interface-mixin"},
"d0eba3fd": {"dfnID":"d0eba3fd","dfnText":"partial interface","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-partial-interface"},{"id":"ref-for-dfn-partial-interface\u2460"}],"title":"3.4.1. \n  [IsolatedContext]\n"}],"url":"https://webidl.spec.whatwg.org/#dfn-partial-interface"},
"d79a826f": {"dfnID":"d79a826f","dfnText":"integrity metadata","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-integrity-metadata"},{"id":"ref-for-concept-request-integrity-metadata\u2460"},{"id":"ref-for-concept-request-integrity-metadata\u2461"}],"title":"3.3.2. Patches to the \"Main Fetch\" algorithm"}],"url":"https://fetch.spec.whatwg.org/#concept-request-integrity-metadata"},
"d7a206d7": {"dfnID":"d7a206d7","dfnText":"interface mixin member","external":true,"refSections":[{"refs":[{"id":"ref-for-interface-mixin-member"},{"id":"ref-for-interface-mixin-member\u2460"}],"title":"3.4.1. \n  [IsolatedContext]\n"}],"url":"https://webidl.spec.whatwg.org/#interface-mixin-member"},
"d9659204": {"dfnID":"d9659204","dfnText":"conditionally exposed","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-conditionally-exposed"},{"id":"ref-for-dfn-conditionally-exposed\u2460"},{"id":"ref-for-dfn-conditionally-exposed\u2461"}],"title":"3.4.2. Patches to the \"exposed\" algorithm"}],"url":"https://webidl.spec.whatwg.org/#dfn-conditionally-exposed"},
"de921304": {"dfnID":"de921304","dfnText":"policy","external":true,"refSections":[{"refs":[{"id":"ref-for-violation-policy"}],"title":"3.1.2. Obtain the active directive for a type"},{"refs":[{"id":"ref-for-violation-policy\u2460"}],"title":"3.1.3. Does a policy sufficiently mitigate plugins?"},{"refs":[{"id":"ref-for-violation-policy\u2461"}],"title":"3.1.4. Does a policy sufficiently mitigate relative URL manipulation?"},{"refs":[{"id":"ref-for-violation-policy\u2462"}],"title":"3.1.5. Does a policy sufficiently mitigate script execution?"},{"refs":[{"id":"ref-for-violation-policy\u2463"}],"title":"3.1.6. Does a policy sufficiently mitigate style evaluation?"},{"refs":[{"id":"ref-for-violation-policy\u2464"}],"title":"3.1.7. Does a policy sufficiently block insecure subresources?"},{"refs":[{"id":"ref-for-violation-policy\u2465"}],"title":"3.1.8. Does a policy sufficiently mitigate DOM sinks?"}],"url":"https://w3c.github.io/webappsec-csp/#violation-policy"},
"dfn-exposed": {"dfnID":"dfn-exposed","dfnText":"exposed","external":false,"refSections":[{"refs":[{"id":"ref-for-dfn-exposed"}],"title":"3.4.1. \n  [IsolatedContext]\n"},{"refs":[{"id":"ref-for-dfn-exposed\u2460"}],"title":"3.4.2. Patches to the \"exposed\" algorithm"}],"url":"#dfn-exposed"},
"eab3771a": {"dfnID":"eab3771a","dfnText":"inherit","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-inherit"}],"title":"3.4.1. \n  [IsolatedContext]\n"}],"url":"https://webidl.spec.whatwg.org/#dfn-inherit"},
"eb1b1af3": {"dfnID":"eb1b1af3","dfnText":"network error","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-network-error"}],"title":"3.3.2. Patches to the \"Main Fetch\" algorithm"}],"url":"https://fetch.spec.whatwg.org/#concept-network-error"},
"ee7bba09": {"dfnID":"ee7bba09","dfnText":"response","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-response"}],"title":"3.2.1. Integrity"},{"refs":[{"id":"ref-for-concept-response\u2460"}],"title":"3.3.1. Verify the integrity of a response"}],"url":"https://fetch.spec.whatwg.org/#concept-response"},
"environment-settings-object-meaningfully-mitigate-injection-attacks": {"dfnID":"environment-settings-object-meaningfully-mitigate-injection-attacks","dfnText":"meaningfully mitigate injection\nattacks","external":false,"refSections":[{"refs":[{"id":"ref-for-environment-settings-object-meaningfully-mitigate-injection-attacks"}],"title":"3.2.2. Environment Settings Object properties"}],"url":"#environment-settings-object-meaningfully-mitigate-injection-attacks"},
"environment-settings-object-mitigate-ui-redressing-attacks": {"dfnID":"environment-settings-object-mitigate-ui-redressing-attacks","dfnText":"mitigate UI Redressing attacks\n","external":false,"refSections":[{"refs":[{"id":"ref-for-environment-settings-object-mitigate-ui-redressing-attacks"}],"title":"3.2.2. Environment Settings Object properties"}],"url":"#environment-settings-object-mitigate-ui-redressing-attacks"},
"f1dafdec": {"dfnID":"f1dafdec","dfnText":"'none'","external":true,"refSections":[{"refs":[{"id":"ref-for-grammardef-none"}],"title":"3.1.3. Does a policy sufficiently mitigate plugins?"},{"refs":[{"id":"ref-for-grammardef-none\u2460"}],"title":"3.1.4. Does a policy sufficiently mitigate relative URL manipulation?"},{"refs":[{"id":"ref-for-grammardef-none\u2461"}],"title":"3.1.5. Does a policy sufficiently mitigate script execution?"},{"refs":[{"id":"ref-for-grammardef-none\u2462"}],"title":"3.1.6. Does a policy sufficiently mitigate style evaluation?"},{"refs":[{"id":"ref-for-grammardef-none\u2463"}],"title":"3.1.7. Does a policy sufficiently block insecure subresources?"},{"refs":[{"id":"ref-for-grammardef-none\u2464"}],"title":"3.1.10. Does a policy meaningfully mitigate UI Redressing attacks?"}],"url":"https://w3c.github.io/webappsec-csp/#grammardef-none"},
"f78d5b5c": {"dfnID":"f78d5b5c","dfnText":"origin","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-origin"}],"title":"3.3.1. Verify the integrity of a response"}],"url":"https://fetch.spec.whatwg.org/#concept-request-origin"},
"f7f36561": {"dfnID":"f7f36561","dfnText":"concrete","external":true,"refSections":[{"refs":[{"id":"ref-for-cross-origin-isolation-concrete"}],"title":"3.2.2. Environment Settings Object properties"}],"url":"https://html.spec.whatwg.org/multipage/document-sequences.html#cross-origin-isolation-concrete"},
"f937b7b6": {"dfnID":"f937b7b6","dfnText":"continue","external":true,"refSections":[{"refs":[{"id":"ref-for-iteration-continue"}],"title":"3.1.1. Does a policy meaningfully mitigate injection attacks?"},{"refs":[{"id":"ref-for-iteration-continue\u2460"}],"title":"3.1.10. Does a policy meaningfully mitigate UI Redressing attacks?"}],"url":"https://infra.spec.whatwg.org/#iteration-continue"},
"fa5ee9c5": {"dfnID":"fa5ee9c5","dfnText":"creation url","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-environment-creation-url"}],"title":"3.5. Storage"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-creation-url"},
"integrity-verification-algorithm": {"dfnID":"integrity-verification-algorithm","dfnText":"integrity verification algorithm","external":false,"refSections":[{"refs":[{"id":"ref-for-integrity-verification-algorithm"},{"id":"ref-for-integrity-verification-algorithm\u2460"}],"title":"3.2.1. Integrity"},{"refs":[{"id":"ref-for-integrity-verification-algorithm\u2461"}],"title":"3.3. Fetch"},{"refs":[{"id":"ref-for-integrity-verification-algorithm\u2462"}],"title":"3.5. Storage"}],"url":"#integrity-verification-algorithm"},
"isolated-context": {"dfnID":"isolated-context","dfnText":"isolated context","external":false,"refSections":[{"refs":[{"id":"ref-for-isolated-context"}],"title":"3.4.1. \n  [IsolatedContext]\n"},{"refs":[{"id":"ref-for-isolated-context\u2460"}],"title":"3.4.2. Patches to the \"exposed\" algorithm"}],"url":"#isolated-context"},
"isolated-contexts": {"dfnID":"isolated-contexts","dfnText":"Isolated Contexts","external":false,"refSections":[{"refs":[{"id":"ref-for-isolated-contexts"}],"title":"2. Isolated Contexts"},{"refs":[{"id":"ref-for-isolated-contexts\u2460"}],"title":"3. Monkey Patches"}],"url":"#isolated-contexts"},
"monkey-main-fetch": {"dfnID":"monkey-main-fetch","dfnText":"main fetch","external":false,"refSections":[{"refs":[{"id":"ref-for-monkey-main-fetch"}],"title":"3.3.2. Patches to the \"Main Fetch\" algorithm"}],"url":"#monkey-main-fetch"},
"origin-integrity-verification-map": {"dfnID":"origin-integrity-verification-map","dfnText":"origin integrity verification map","external":false,"refSections":[{"refs":[{"id":"ref-for-origin-integrity-verification-map"}],"title":"3.2.1. Integrity"},{"refs":[{"id":"ref-for-origin-integrity-verification-map\u2460"}],"title":"3.2.2. Environment Settings Object properties"},{"refs":[{"id":"ref-for-origin-integrity-verification-map\u2461"},{"id":"ref-for-origin-integrity-verification-map\u2462"}],"title":"3.3.1. Verify the integrity of a response"},{"refs":[{"id":"ref-for-origin-integrity-verification-map\u2463"}],"title":"3.5. Storage"}],"url":"#origin-integrity-verification-map"},
"policy-sufficiently-blocks-insecure-subresources": {"dfnID":"policy-sufficiently-blocks-insecure-subresources","dfnText":"sufficiently blocks insecure\nsubresources","external":false,"refSections":[{"refs":[{"id":"ref-for-policy-sufficiently-blocks-insecure-subresources"}],"title":"3.1.1. Does a policy meaningfully mitigate injection attacks?"}],"url":"#policy-sufficiently-blocks-insecure-subresources"},
"policy-sufficiently-mitigates-dom-sinks": {"dfnID":"policy-sufficiently-mitigates-dom-sinks","dfnText":"sufficiently mitigates DOM sinks","external":false,"refSections":[{"refs":[{"id":"ref-for-policy-sufficiently-mitigates-dom-sinks"}],"title":"3.1.1. Does a policy meaningfully mitigate injection attacks?"}],"url":"#policy-sufficiently-mitigates-dom-sinks"},
"policy-sufficiently-mitigates-plugins": {"dfnID":"policy-sufficiently-mitigates-plugins","dfnText":"sufficiently mitigates plugins","external":false,"refSections":[{"refs":[{"id":"ref-for-policy-sufficiently-mitigates-plugins"}],"title":"3.1.1. Does a policy meaningfully mitigate injection attacks?"}],"url":"#policy-sufficiently-mitigates-plugins"},
"policy-sufficiently-mitigates-relative-url-manipulation": {"dfnID":"policy-sufficiently-mitigates-relative-url-manipulation","dfnText":"sufficiently mitigates relative URL\nmanipulation","external":false,"refSections":[{"refs":[{"id":"ref-for-policy-sufficiently-mitigates-relative-url-manipulation"}],"title":"3.1.1. Does a policy meaningfully mitigate injection attacks?"}],"url":"#policy-sufficiently-mitigates-relative-url-manipulation"},
"policy-sufficiently-mitigates-script-execution": {"dfnID":"policy-sufficiently-mitigates-script-execution","dfnText":"sufficiently mitigates script execution","external":false,"refSections":[{"refs":[{"id":"ref-for-policy-sufficiently-mitigates-script-execution"}],"title":"3.1.1. Does a policy meaningfully mitigate injection attacks?"}],"url":"#policy-sufficiently-mitigates-script-execution"},
"policy-sufficiently-mitigates-style-evaluation": {"dfnID":"policy-sufficiently-mitigates-style-evaluation","dfnText":"sufficiently mitigates style evaluation","external":false,"refSections":[{"refs":[{"id":"ref-for-policy-sufficiently-mitigates-style-evaluation"}],"title":"3.1.1. Does a policy meaningfully mitigate injection attacks?"}],"url":"#policy-sufficiently-mitigates-style-evaluation"},
"verify-the-integrity-of-a-response": {"dfnID":"verify-the-integrity-of-a-response","dfnText":"verify the integrity of a response","external":false,"refSections":[{"refs":[{"id":"ref-for-verify-the-integrity-of-a-response"}],"title":"3.3.2. Patches to the \"Main Fetch\" algorithm"}],"url":"#verify-the-integrity-of-a-response"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#IsolatedContext": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"isolated-contexts","spec":"isolated-contexts-1","status":"local","text":"IsolatedContext","type":"extended-attribute","url":"#IsolatedContext"},
"#abstract-opdef-obtain-directive": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"isolated-contexts","spec":"isolated-contexts-1","status":"local","text":"obtain-directive","type":"abstract-op","url":"#abstract-opdef-obtain-directive"},
"#csp-list-meaningfully-mitigate-injection-attacks": {"export":true,"for_":["CSP list"],"level":"1","normative":true,"shortname":"isolated-contexts","spec":"isolated-contexts-1","status":"local","text":"mitigate-injection","type":"dfn","url":"#csp-list-meaningfully-mitigate-injection-attacks"},
"#csp-list-meaningfully-mitigate-ui-redressing-attacks": {"export":true,"for_":["CSP list"],"level":"1","normative":true,"shortname":"isolated-contexts","spec":"isolated-contexts-1","status":"local","text":"mitigate-ui-redressing","type":"dfn","url":"#csp-list-meaningfully-mitigate-ui-redressing-attacks"},
"#dfn-exposed": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"isolated-contexts","spec":"isolated-contexts-1","status":"local","text":"exposed","type":"dfn","url":"#dfn-exposed"},
"#environment-settings-object-meaningfully-mitigate-injection-attacks": {"export":true,"for_":["environment settings object"],"level":"1","normative":true,"shortname":"isolated-contexts","spec":"isolated-contexts-1","status":"local","text":"meaningfully mitigate injection attacks","type":"dfn","url":"#environment-settings-object-meaningfully-mitigate-injection-attacks"},
"#environment-settings-object-mitigate-ui-redressing-attacks": {"export":true,"for_":["environment settings object"],"level":"1","normative":true,"shortname":"isolated-contexts","spec":"isolated-contexts-1","status":"local","text":"mitigate ui redressing attacks","type":"dfn","url":"#environment-settings-object-mitigate-ui-redressing-attacks"},
"#integrity-verification-algorithm": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"isolated-contexts","spec":"isolated-contexts-1","status":"local","text":"integrity verification algorithm","type":"dfn","url":"#integrity-verification-algorithm"},
"#isolated-context": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"isolated-contexts","spec":"isolated-contexts-1","status":"local","text":"isolated context","type":"dfn","url":"#isolated-context"},
"#isolated-contexts": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"isolated-contexts","spec":"isolated-contexts-1","status":"local","text":"isolated contexts","type":"dfn","url":"#isolated-contexts"},
"#monkey-main-fetch": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"isolated-contexts","spec":"isolated-contexts-1","status":"local","text":"main fetch","type":"dfn","url":"#monkey-main-fetch"},
"#origin-integrity-verification-map": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"isolated-contexts","spec":"isolated-contexts-1","status":"local","text":"origin integrity verification map","type":"dfn","url":"#origin-integrity-verification-map"},
"#policy-sufficiently-blocks-insecure-subresources": {"export":true,"for_":["policy"],"level":"1","normative":true,"shortname":"isolated-contexts","spec":"isolated-contexts-1","status":"local","text":"sufficiently blocks insecure subresources","type":"dfn","url":"#policy-sufficiently-blocks-insecure-subresources"},
"#policy-sufficiently-mitigates-dom-sinks": {"export":true,"for_":["policy"],"level":"1","normative":true,"shortname":"isolated-contexts","spec":"isolated-contexts-1","status":"local","text":"sufficiently mitigates dom sinks","type":"dfn","url":"#policy-sufficiently-mitigates-dom-sinks"},
"#policy-sufficiently-mitigates-plugins": {"export":true,"for_":["policy"],"level":"1","normative":true,"shortname":"isolated-contexts","spec":"isolated-contexts-1","status":"local","text":"sufficiently mitigates plugins","type":"dfn","url":"#policy-sufficiently-mitigates-plugins"},
"#policy-sufficiently-mitigates-relative-url-manipulation": {"export":true,"for_":["policy"],"level":"1","normative":true,"shortname":"isolated-contexts","spec":"isolated-contexts-1","status":"local","text":"sufficiently mitigates relative url manipulation","type":"dfn","url":"#policy-sufficiently-mitigates-relative-url-manipulation"},
"#policy-sufficiently-mitigates-script-execution": {"export":true,"for_":["policy"],"level":"1","normative":true,"shortname":"isolated-contexts","spec":"isolated-contexts-1","status":"local","text":"sufficiently mitigates script execution","type":"dfn","url":"#policy-sufficiently-mitigates-script-execution"},
"#policy-sufficiently-mitigates-style-evaluation": {"export":true,"for_":["policy"],"level":"1","normative":true,"shortname":"isolated-contexts","spec":"isolated-contexts-1","status":"local","text":"sufficiently mitigates style evaluation","type":"dfn","url":"#policy-sufficiently-mitigates-style-evaluation"},
"#verify-the-integrity-of-a-response": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"isolated-contexts","spec":"isolated-contexts-1","status":"local","text":"verify the integrity of a response","type":"dfn","url":"#verify-the-integrity-of-a-response"},
"https://fetch.spec.whatwg.org/#concept-fetch": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"fetch","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-fetch"},
"https://fetch.spec.whatwg.org/#concept-network-error": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"network error","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-network-error"},
"https://fetch.spec.whatwg.org/#concept-request-client": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"client","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-client"},
"https://fetch.spec.whatwg.org/#concept-request-integrity-metadata": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"integrity metadata","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-integrity-metadata"},
"https://fetch.spec.whatwg.org/#concept-request-origin": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"origin","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-origin"},
"https://fetch.spec.whatwg.org/#concept-response": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"response","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-response"},
"https://fetch.spec.whatwg.org/#concept-response-body": {"export":true,"for_":["response"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"body","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-response-body"},
"https://fetch.spec.whatwg.org/#fetch-params": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"fetch params","type":"dfn","url":"https://fetch.spec.whatwg.org/#fetch-params"},
"https://fetch.spec.whatwg.org/#fetch-params-request": {"export":false,"for_":["fetch params"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"request","type":"dfn","url":"https://fetch.spec.whatwg.org/#fetch-params-request"},
"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-tuple": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"tuple origin","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-tuple"},
"https://html.spec.whatwg.org/multipage/browsers.html#policy-container-csp-list": {"export":true,"for_":["policy container"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"csp list","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#policy-container-csp-list"},
"https://html.spec.whatwg.org/multipage/document-sequences.html#cross-origin-isolation-concrete": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"concrete","type":"dfn","url":"https://html.spec.whatwg.org/multipage/document-sequences.html#cross-origin-isolation-concrete"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-creation-url": {"export":true,"for_":["environment"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"creation url","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-creation-url"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin": {"export":true,"for_":["environment"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"top-level origin","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-settings-object": {"export":true,"for_":["realm"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"settings object","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-settings-object"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-cross-origin-isolated-capability": {"export":true,"for_":["environment settings object"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"cross-origin isolated capability","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-cross-origin-isolated-capability"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global": {"export":true,"for_":["environment settings object"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"global object","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin": {"export":true,"for_":["environment settings object"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"origin","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-policy-container": {"export":true,"for_":["environment settings object"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"policy container","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-policy-container"},
"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"environment settings object","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object"},
"https://html.spec.whatwg.org/multipage/webappapis.html#secure-context": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"secure context","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#secure-context"},
"https://infra.spec.whatwg.org/#ascii-case-insensitive": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"ascii case-insensitive","type":"dfn","url":"https://infra.spec.whatwg.org/#ascii-case-insensitive"},
"https://infra.spec.whatwg.org/#boolean": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"boolean","type":"dfn","url":"https://infra.spec.whatwg.org/#boolean"},
"https://infra.spec.whatwg.org/#implementation-defined": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"implementation-defined","type":"dfn","url":"https://infra.spec.whatwg.org/#implementation-defined"},
"https://infra.spec.whatwg.org/#iteration-continue": {"export":true,"for_":["iteration"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"continue","type":"dfn","url":"https://infra.spec.whatwg.org/#iteration-continue"},
"https://infra.spec.whatwg.org/#list-contain": {"export":true,"for_":["list","stack","queue","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"contain","type":"dfn","url":"https://infra.spec.whatwg.org/#list-contain"},
"https://infra.spec.whatwg.org/#list-iterate": {"export":true,"for_":["list","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"for each","type":"dfn","url":"https://infra.spec.whatwg.org/#list-iterate"},
"https://infra.spec.whatwg.org/#list-size": {"export":true,"for_":["list","stack","queue","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"size","type":"dfn","url":"https://infra.spec.whatwg.org/#list-size"},
"https://infra.spec.whatwg.org/#map-exists": {"export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"exist","type":"dfn","url":"https://infra.spec.whatwg.org/#map-exists"},
"https://infra.spec.whatwg.org/#ordered-map": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"map","type":"dfn","url":"https://infra.spec.whatwg.org/#ordered-map"},
"https://infra.spec.whatwg.org/#tuple": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"tuple","type":"dfn","url":"https://infra.spec.whatwg.org/#tuple"},
"https://infra.spec.whatwg.org/#user-agent": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"user agent","type":"dfn","url":"https://infra.spec.whatwg.org/#user-agent"},
"https://storage.spec.whatwg.org/#obtain-a-storage-key-for-non-storage-purposes": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"storage","spec":"storage","status":"current","text":"obtain a storage key for non-storage purposes","type":"dfn","url":"https://storage.spec.whatwg.org/#obtain-a-storage-key-for-non-storage-purposes"},
"https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#realm": {"export":true,"for_":["ECMAScript"],"level":"1","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"current","text":"realm","type":"dfn","url":"https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#realm"},
"https://w3c.github.io/trusted-types/dist/spec/#require-trusted-types-for-directive": {"export":true,"for_":[],"level":"","normative":true,"shortname":"trusted-types","spec":"trusted-types","status":"anchor-block","text":"require-trusted-types-for-directive","type":"dfn","url":"https://w3c.github.io/trusted-types/dist/spec/#require-trusted-types-for-directive"},
"https://w3c.github.io/webappsec-csp/#csp-list": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"csp","spec":"csp3","status":"current","text":"csp list","type":"dfn","url":"https://w3c.github.io/webappsec-csp/#csp-list"},
"https://w3c.github.io/webappsec-csp/#directive-fallback-list": {"export":true,"for_":[],"level":"","normative":true,"shortname":"csp3","spec":"csp3","status":"anchor-block","text":"Get fetch directive fallback list","type":"abstract-op","url":"https://w3c.github.io/webappsec-csp/#directive-fallback-list"},
"https://w3c.github.io/webappsec-csp/#directive-name": {"export":true,"for_":["directive"],"level":"3","normative":true,"shortname":"csp","spec":"csp3","status":"current","text":"name","type":"dfn","url":"https://w3c.github.io/webappsec-csp/#directive-name"},
"https://w3c.github.io/webappsec-csp/#directive-value": {"export":true,"for_":["directive"],"level":"3","normative":true,"shortname":"csp","spec":"csp3","status":"current","text":"value","type":"dfn","url":"https://w3c.github.io/webappsec-csp/#directive-value"},
"https://w3c.github.io/webappsec-csp/#directives": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"csp","spec":"csp3","status":"current","text":"directives","type":"dfn","url":"https://w3c.github.io/webappsec-csp/#directives"},
"https://w3c.github.io/webappsec-csp/#grammardef-none": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"csp","spec":"csp3","status":"current","text":"'none'","type":"grammar","url":"https://w3c.github.io/webappsec-csp/#grammardef-none"},
"https://w3c.github.io/webappsec-csp/#grammardef-self": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"csp","spec":"csp3","status":"current","text":"'self'","type":"grammar","url":"https://w3c.github.io/webappsec-csp/#grammardef-self"},
"https://w3c.github.io/webappsec-csp/#grammardef-unsafe-inline": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"csp","spec":"csp3","status":"current","text":"'unsafe-inline'","type":"grammar","url":"https://w3c.github.io/webappsec-csp/#grammardef-unsafe-inline"},
"https://w3c.github.io/webappsec-csp/#grammardef-wasm-unsafe-eval": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"csp","spec":"csp3","status":"current","text":"'wasm-unsafe-eval'","type":"grammar","url":"https://w3c.github.io/webappsec-csp/#grammardef-wasm-unsafe-eval"},
"https://w3c.github.io/webappsec-csp/#policy-directive-set": {"export":true,"for_":["policy"],"level":"3","normative":true,"shortname":"csp","spec":"csp3","status":"current","text":"directive set","type":"dfn","url":"https://w3c.github.io/webappsec-csp/#policy-directive-set"},
"https://w3c.github.io/webappsec-csp/#policy-disposition": {"export":true,"for_":["policy"],"level":"3","normative":true,"shortname":"csp","spec":"csp3","status":"current","text":"disposition","type":"dfn","url":"https://w3c.github.io/webappsec-csp/#policy-disposition"},
"https://w3c.github.io/webappsec-csp/#policy-source": {"export":true,"for_":["policy"],"level":"3","normative":true,"shortname":"csp","spec":"csp3","status":"current","text":"source","type":"dfn","url":"https://w3c.github.io/webappsec-csp/#policy-source"},
"https://w3c.github.io/webappsec-csp/#source-expression": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"csp","spec":"csp3","status":"current","text":"source expression","type":"dfn","url":"https://w3c.github.io/webappsec-csp/#source-expression"},
"https://w3c.github.io/webappsec-csp/#violation-policy": {"export":true,"for_":["violation"],"level":"3","normative":true,"shortname":"csp","spec":"csp3","status":"current","text":"policy","type":"dfn","url":"https://w3c.github.io/webappsec-csp/#violation-policy"},
"https://webidl.spec.whatwg.org/#CrossOriginIsolated": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"CrossOriginIsolated","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#CrossOriginIsolated"},
"https://webidl.spec.whatwg.org/#SecureContext": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"SecureContext","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#SecureContext"},
"https://webidl.spec.whatwg.org/#dfn-callback-interface": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"callback interface","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-callback-interface"},
"https://webidl.spec.whatwg.org/#dfn-conditionally-exposed": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"conditionally exposed","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-conditionally-exposed"},
"https://webidl.spec.whatwg.org/#dfn-exposure-set": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"exposure set","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-exposure-set"},
"https://webidl.spec.whatwg.org/#dfn-extended-attribute": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"extended attribute","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-extended-attribute"},
"https://webidl.spec.whatwg.org/#dfn-inherit": {"export":true,"for_":["interface"],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"inherit","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-inherit"},
"https://webidl.spec.whatwg.org/#dfn-interface": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"interface","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-interface"},
"https://webidl.spec.whatwg.org/#dfn-interface-member": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"interface member","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-interface-member"},
"https://webidl.spec.whatwg.org/#dfn-member": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"members","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-member"},
"https://webidl.spec.whatwg.org/#dfn-namespace": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"namespace","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-namespace"},
"https://webidl.spec.whatwg.org/#dfn-namespace-member": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"namespace member","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-namespace-member"},
"https://webidl.spec.whatwg.org/#dfn-operation": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"operation","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-operation"},
"https://webidl.spec.whatwg.org/#dfn-overloaded": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"overloaded","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-overloaded"},
"https://webidl.spec.whatwg.org/#dfn-partial-interface": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"partial interface","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-partial-interface"},
"https://webidl.spec.whatwg.org/#dfn-partial-namespace": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"partial namespace","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-partial-namespace"},
"https://webidl.spec.whatwg.org/#dfn-xattr-no-arguments": {"export":true,"for_":["extended attribute"],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"takes no arguments","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-xattr-no-arguments"},
"https://webidl.spec.whatwg.org/#interface-mixin": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"interface mixin","type":"dfn","url":"https://webidl.spec.whatwg.org/#interface-mixin"},
"https://webidl.spec.whatwg.org/#interface-mixin-member": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"interface mixin member","type":"dfn","url":"https://webidl.spec.whatwg.org/#interface-mixin-member"},
"https://webidl.spec.whatwg.org/#partial-interface-mixin": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"partial interface mixin","type":"dfn","url":"https://webidl.spec.whatwg.org/#partial-interface-mixin"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.text != linkText) {
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.text)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const ref = refsData[url];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>
<script>/* Boilerplate: script-var-click-highlighting */
"use strict";
{
/*
Color-choosing design:

* Colors are ordered by goodness.
* On clicking a var, give it the earliest color
    with the lowest usage in the algorithm.
* On re-clicking, re-use the var's most recent color
    if that's not currently being used elsewhere.
*/

const COLOR_COUNT = 7;

document.addEventListener("click", e=>{
    if(e.target.nodeName == "VAR") {
        highlightSameAlgoVars(e.target);
    }
});

function highlightSameAlgoVars(v) {
    // Find the algorithm container.
    let algoContainer = findAlgoContainer(v);

    // Not highlighting document-global vars,
    // too likely to be unrelated.
    if(algoContainer == null) return;

    const varName = nameFromVar(v);
    if(!v.hasAttribute("data-var-color")) {
        const newColor = chooseHighlightColor(algoContainer, v);
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.setAttribute("data-var-color", newColor);
                el.setAttribute("data-var-last-color", newColor);
            }
        }
    } else {
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.removeAttribute("data-var-color");
            }
        }
    }
}
function findAlgoContainer(el) {
    while(el != document.body) {
        if(el.hasAttribute("data-algorithm")) return el;
        el = el.parentNode;
    }
    return null;
}
function nameFromVar(el) {
    return el.textContent.replace(/(\s|\xa0)+/g, " ").trim();
}
function colorCountsFromContainer(container) {
    const namesFromColor = Array.from({length:COLOR_COUNT}, x=>new Set());
    for(let v of container.querySelectorAll("var[data-var-color]")) {
        let color = +v.getAttribute("data-var-color");
        namesFromColor[color].add(nameFromVar(v));
    }

    return namesFromColor.map(x=>x.size);
}
function leastUsedColor(colors) {
    // Find the earliest color with the lowest count.
    let minCount = Infinity;
    let minColor = null;
    for(var i = 0; i < colors.length; i++) {
        if(colors[i] < minCount) {
            minColor = i;
            minCount = colors[i];
        }
    }
    return minColor;
}
function chooseHighlightColor(container, v) {
    const colorCounts = colorCountsFromContainer(container);
    if(v.hasAttribute("data-var-last-color")) {
        let color = +v.getAttribute("data-var-last-color");
        if(colorCounts[color] == 0) return color;
    }
    return leastUsedColor(colorCounts);
}
}
</script>